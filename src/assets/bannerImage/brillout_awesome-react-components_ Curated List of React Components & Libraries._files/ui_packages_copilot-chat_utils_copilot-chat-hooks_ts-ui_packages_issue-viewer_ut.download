"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_copilot-chat_utils_copilot-chat-hooks_ts-ui_packages_issue-viewer_utils_queries_ts"],{66444:(e,t,s)=>{s.d(t,{L:()=>BlackbirdPermissionCaches});var r=s(43311),a=s(46335);let BlackbirdPermissionCaches=class BlackbirdPermissionCaches{async setupWarmCachesLoop(){(0,r.M3)()&&(BlackbirdPermissionCaches.warmCachesLoopSetup?await BlackbirdPermissionCaches.warm:(BlackbirdPermissionCaches.warmCachesLoopSetup=!0,await this.warmCaches()))}async warmCaches(){let e=54e4;try{let t=await (0,a.lS)("/search/warm_blackbird_caches",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}),s=await t.json();e=new Date(s.userCacheExpiresAt).getTime()-Date.now()-3e4,(isNaN(e)||e<=5)&&(e=3e4)}catch{}BlackbirdPermissionCaches.warmResolve(),setTimeout(()=>{this.warmCaches()},e)}};BlackbirdPermissionCaches.warmCachesLoopSetup=!1,BlackbirdPermissionCaches.warm=new Promise(e=>{BlackbirdPermissionCaches.warmResolve=e})},22942:(e,t,s)=>{s.d(t,{J:()=>CopilotAuthTokenProvider});let AuthToken=class AuthToken{get authorizationHeaderValue(){return`GitHub-Bearer ${this.value}`}needsRefreshing(e){return this.isExpired||this.ssoChanged(e)}get isExpired(){let e=new Date(this.expiration);return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))<new Date(Date.now()+15e3)}ssoChanged(e){return!(this.ssoOrgIDs.every(t=>e.includes(t))&&e.every(e=>this.ssoOrgIDs.includes(e)))}static fromResult(e,t){return new AuthToken(e.token,e.expiration,t)}serialize(){return{value:this.value,expiration:this.expiration,ssoOrgIDs:this.ssoOrgIDs}}static deserialize(e){return new AuthToken(e.value,e.expiration,e.ssoOrgIDs)}constructor(e,t,s){this.value=e,this.expiration=t,this.ssoOrgIDs=s}};var r=s(10943),a=s(46335);let i="COPILOT_AUTH_TOKEN";let CopilotAuthTokenProvider=class CopilotAuthTokenProvider{async getAuthToken(){let e=this.getLocalStorageAuthToken();return e?this.validateAuthToken(e):this.fetchAuthToken()}setLocalStorageAuthToken(e){this.copilotLocalStorage.setItem(i,JSON.stringify(e.serialize()))}getLocalStorageAuthToken(){let e=this.copilotLocalStorage.getItem(i);return e?AuthToken.deserialize(JSON.parse(e)):null}async validateAuthToken(e){return e.needsRefreshing(this.ssoOrgIDs)?this.fetchAuthToken():e}fetchAuthToken(){return this.currentAuthTokenRequest||(this.currentAuthTokenRequest=this._fetchAuthToken()),this.currentAuthTokenRequest}async _fetchAuthToken(){let e=await (0,a.lS)("/github-copilot/chat/token",{method:"POST"});if(e.ok){let t=await e.json();this.currentAuthTokenRequest=null;let s=AuthToken.fromResult(t,this.ssoOrgIDs);return this.setLocalStorageAuthToken(s),s}throw this.currentAuthTokenRequest=null,Error("Failed to mint new auth token")}constructor(e){this.ssoOrgIDs=e,this.currentAuthTokenRequest=null,this.copilotLocalStorage=(0,r.A)("localStorage",{throwQuotaErrorsOnSet:!1,ttl:864e5})}}},85749:(e,t,s)=>{s.d(t,{d:()=>ApiCache});let ApiCache=class ApiCache{async get(...e){let t=e.join(this.separator),s=this.cache.get(t);if(s)return s;{let s=this.fetchFn(...e);return this.cache.set(t,s),(await s).ok||this.cache.delete(t),s}}constructor(e){this.fetchFn=e,this.separator="-!-",this.cache=new Map}}},51315:(e,t,s)=>{s.d(t,{Bc:()=>i,fv:()=>n,uN:()=>a,wg:()=>r});let r="copilot-chat-textarea",a="copilot-chat-topic-search",i="Review",n="copilot-chat-header-button"},38253:(e,t,s)=>{s.d(t,{CB:()=>d,DW:()=>l,F2:()=>x,JP:()=>m,Jz:()=>n,Mw:()=>S,OC:()=>T,P:()=>O,Q7:()=>N,Qt:()=>w,SI:()=>k,Sr:()=>o,Th:()=>P,UU:()=>C,Vb:()=>p,Xo:()=>E,Xs:()=>g,Y6:()=>u,Ye:()=>G,Z6:()=>A,Z8:()=>f,Zn:()=>b,_2:()=>I,iW:()=>y,k4:()=>U,mx:()=>$,p:()=>c,qS:()=>R,s0:()=>L,x_:()=>D,yR:()=>v,yh:()=>M,z$:()=>h});var r=s(4227),a=s(94194),i=s(76513);let n="/copilot",o={400:"This message could not be processed.",401:"You\u2019re not authorized to use Copilot.",403:"This response could not be shown as it violates GitHub\u2019s content policies.",404:"Resource not found. Please try again.",408:"Your network connection was interrupted. Please try again.",413:"Message too large. Please shorten it or remove some references and try again.",429:"GitHub API rate limit exceeded. Please wait and try again."},l="I'm sorry but there was an error. Please try again.";async function c({authToken:e,basePath:t,body:s,integrationId:r,method:i,path:n,streamingResponse:c=!1,realIp:u,signal:d}){try{let h={Authorization:e.authorizationHeaderValue,"copilot-integration-id":r};for(let e of(0,a.f)()){let t=e.split("="),s=t[0]?.replaceAll("_","-"),r="1";t.length>1&&(r=t[1]),h[`X-Experiment-${s}`]=r}c&&(h["Content-Type"]="text/event-stream"),u&&(h["X-Real-IP"]=u);let p=await fetch(t+n,{method:i,mode:"cors",cache:"no-cache",headers:h,body:JSON.stringify(s),signal:d});if(p.ok)return p;return{status:p.status,ok:!1,error:o[p.status]||l}}catch{return{status:500,ok:!1,error:l}}}function u({role:e,content:t,error:s,references:r=[],thread:a,confirmationResponses:i,clientSkillConfirmations:n,active:o,parentMessageID:l}){return{id:crypto.randomUUID(),threadID:a?.id||"temp",role:e,content:t,createdAt:new Date().toISOString(),error:s,references:r,skillExecutions:[],clientConfirmations:i,confirmations:n,active:o,parentMessageID:l}}function d(e){return e?.name||"New conversation"}function h(e){switch(e.type){case"file":case"folder":return _(e);case"file-diff":return S(e);case"snippet":return function(e){if(e.title)return e.title;let t=e.path.split("/").pop(),s=`${e.range.start}-${e.range.end}`;return`${t}:${s}`}(e);case"repository":return`${e.ownerLogin}/${e.name}`;case"symbol":case"docset":return e.name;case"commit":return e.message;case"pull-request":return e.title;case"tree-comparison":return`${e.baseRevision.substring(0,5)}..${e.headRevision.substring(0,5)}`;case"third-party":return e.displayName;case"workspace-terminal-log":return"terminal log";case"text":return e.name?e.name:"text reference";case"repo-instructions":return"copilot-instructions.md";default:return"unrecognized reference"}}function p(e){switch(e.type){case"file":return`${e.type}-${e.repoOwner}/${e.repoName}@${e.commitOID}:${e.path}`;case"folder":return`${e.type}-${e.repoOwner}/${e.repoName}@${e.ref}:${e.path}`;case"file-changes":return`${e.type}-${e.repository.owner}/${e.repository.owner}@${e.ref}:${e.path}`;case"file-diff":return`${e.type}:${e.baseFile?.path}@${e.baseFile?.commitOID}-${e.headFile?.path}@${e.headFile?.commitOID}##${e.selectedRange?.start}-${e.selectedRange?.end}`;case"snippet":return`${e.type}-${e.repoOwner}/${e.repoName}@${e.commitOID}:${e.path}#${e.range.start}-${e.range.end}`;case"repository":return`${e.type}-${e.id}-${e.ownerLogin}/${e.name}`;case"symbol":return`${e.type}-${e.kind}-${e.name}`;case"docset":return`${e.type}-${e.name}`;case"commit":return`${e.type}-@${e.oid}-${e.repository.owner}/${e.repository.name}`;case"pull-request":return`${e.type}-${e.commit}-${e.repository.ownerLogin}/${e.repository.name}`;case"web-search":return`${e.type}-${e.query}`;case"workspace-terminal-log":return`${e.type}-${e.repoOwner}/${e.repoName}@${e.pullRequestID}`;case"repo-instructions":return`${e.type}-.github/custom-instructions.md`;default:return""}}function m(e){switch(e.type){case"file":case"file-diff":case"folder":case"pull-request":case"repo-instructions":return e.url;case"repository":return`/${e.ownerLogin}/${e.name}`;case"commit":return e.permalink;case"third-party":return e.displayUrl;case"snippet":return function(e){if(("file"===e.type||"snippet"===e.type)&&e.languageName&&"markdown"===e.languageName.toLowerCase()){let t=new URL(e.url,window.location.origin);return t.search="plain=1",t.href}return e.url}(e);default:return"#"}}function g(e){return"#"!==e&&""!==e}function f(e){let t=e.path.split("/");return(t.pop(),0===t.length)?"/":t.join("/")}function E(e){return _(e)}function _(e){return e.path.split("/").pop()||e.path}function S(e){let t=e.headFile?.path??e.baseFile?.path??e.head?.path??e.base?.path,s=t?.split("/").pop()??"";return e.selectedRange&&e.selectedRange.start?e.selectedRange.end&&e.selectedRange.start!==e.selectedRange.end?`${s} ${e.selectedRange.start}-${e.selectedRange.end}`:`${s} ${e.selectedRange.start}`:s}function y(e,t){return{type:"file",url:new URL((0,r.IO9)({repo:t,commitish:t.refInfo.name,action:"blob",path:e}),window.location.origin).href,path:e,repoID:t.id,repoOwner:t.ownerLogin,repoName:t.name,ref:t.ref,commitOID:t.commitOID}}function T(e,t){return{type:"folder",url:new URL((0,r.IO9)({repo:t,commitish:t.refInfo.name,action:"tree",path:e}),window.location.origin).href,path:e,repoID:t.id,repoOwner:t.ownerLogin,repoName:t.name,ref:t.ref}}function w(e,t){let s=e.symbol?.fully_qualified_name||"";return{type:"symbol",kind:"suggestionSymbol",name:s,suggestionDefinitions:[{identOffset:{start:e.symbol?.ident_start||0,end:e.symbol?.ident_end||0},extentOffset:{start:e.symbol?.extent_start||0,end:e.symbol?.extent_end||0},kind:e.symbol?.kind||"",fullyQualifiedName:s,repoID:t.id,repoOwner:t.ownerLogin,repoName:t.name,ref:e.commit_sha,commitOID:e.commit_sha,path:e.path}],languageID:e.language_id}}function C(e){return{...e,type:"docset"}}function I(){return{type:"magic-knowledge-base"}}function R(e){return{...e,type:"repository"}}function O(e){return!!e&&"sourceRepos"in e}function A(e){return!!e&&!O(e)}function D(e,t){return e===t||void 0!==e&&void 0!==t&&p(e)===p(t)}function v(e,t){if(void 0===e&&void 0===t)return!0;if(void 0===e||void 0===t||e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!D(e[s],t[s]))return!1;return!0}function L(e,t){e(!0),"immersive"===t&&window.history.pushState(null,"",`${n}`)}function k(e){return"file"===e.type}function b(e){return"snippet"===e.type}function P(e,t){if("user"===e.role)return{name:t,avatarURL:`/${t}.png`,type:"user"};if(e.references){let t=e.references.find(e=>"github.agent"===e.type);if(t)return{name:t.login,avatarURL:t.avatarURL,type:"agent"}}return{name:"Copilot",avatarURL:"",type:"copilot"}}function M(e){return"agent"===e.type}function N(e){let t=e.map(e=>P(e,"")).filter(e=>e?.type==="agent"),s=new Map;for(let e of t)s.set(e.name,e);return Array.from(s.values())}function x(e){let t=new Date(e.updatedAt).getTime();return Date.now()-t>144e5}function G(e){if(!e)return[];let t=new Set;return e.filter(e=>{let s=JSON.stringify(e.confirmation);return!t.has(s)&&(t.add(s),!0)})}function $(e){let t=e?e.replace(/(\.api|-v2)$/,"").toLowerCase():"default";return{referenceType:e,suggestions:U(i.y$[t]||i.y$.default).slice(0,3)}}function U(e){let t=e.slice();for(let e=t.length-1;e>0;e--){let s=Math.floor(Math.random()*(e+1)),r=t[e];t[e]=t[s],t[s]=r}return t}},20772:(e,t,s)=>{s.d(t,{Ld:()=>g,M8:()=>E,Tz:()=>y,U2:()=>f,W5:()=>d,cx:()=>m,o6:()=>T,r_:()=>S,vn:()=>_,xG:()=>h});var r=s(46335),a=s(97665),i=s(40458),n=s(94747),o=s(97286),l=s(96540),c=s(3004),u=s(2982);s(26973);var d=function(e){return e.Unindexed="not_indexed",e.Indexed="indexed",e.Indexing="indexing",e.PartiallyIndexed="partially_indexed",e.Unknown="unknown",e}({}),h=function(e){return e.Requested="requested",e.NotFound="not_found",e.Unauthorized="unauthorized",e.ServiceUnavailable="service_unavailable",e.QuotaExhausted="quota_exhausted",e.Forbidden="forbidden",e.CanIndex="ok",e.IndexingError="indexing_error",e.RequestFailed="request_failed",e.Unknown="unknown",e}({});let p=["not_found","unauthorized","service_unavailable","quota_exhausted","forbidden","request_failed"],m=256,g=400;function f(e,t,s){let r=(0,l.useRef)(void 0),a=(0,l.useRef)(void 0),i=(0,l.useRef)([]),n=(0,l.useRef)(!1),[o,c]=(0,l.useState)([]),[u,d]=(0,l.useState)(!0),h=(0,l.useCallback)(()=>{c([]),d(!1)},[]),p=(0,l.useCallback)(()=>{if(s&&e)try{let e=new Worker(s);e.onmessage=({data:e})=>{n.current=!1,c(e.list),d(!1),a.current=e.query,i.current=e.list},r.current=e}catch(e){console.warn("Web workers are not available: ",e)}},[s,e]),m=(0,l.useCallback)(t=>{n.current&&(r.current?.terminate(),p());let s=a.current&&t.startsWith(a.current)&&i.current.length;d(!0),n.current=!0,r.current?.postMessage({baseList:s?i.current:e,query:t})},[e,p]);return((0,l.useEffect)(()=>(p(),()=>r.current?.terminate()),[p]),(0,l.useEffect)(()=>{m(t)},[t,m]),s)?[o,u,h]:[[],!1,()=>{}]}function E(e){var t,s;let r=(0,a.jE)(),o=(0,l.useCallback)(()=>Promise.all(e.map(e=>r.invalidateQueries({queryKey:["copilot-chat","repos-indexing-state",e]}))),[r,e]),c=(0,i.E)({queries:e.map(e=>({queryKey:["copilot-chat","repos-indexing-state",e],queryFn:()=>w(e),placeholderData:{requestStatus:"unknown",code:"unknown",docs:"unknown"},staleTime:1/0}))}),{mutate:u}=(0,n.n)({mutationKey:["repos-indexing-state"],mutationFn:()=>C(e),onSuccess:o}),d={requestStatus:0===(s=(t=c.map(e=>e.data)).map(e=>e.requestStatus)).length?"unknown":s.some(e=>p.includes(e))?"indexing_error":s.every(e=>"ok"===e)?"ok":(s.every(e=>"unknown"===e),"unknown"),code:R(t.map(e=>e.code)),docs:R(t.map(e=>e.docs)),remainingRepoIndexTokens:t[0]?.remainingRepoIndexTokens};return O(()=>void o(),"indexing"===d.code&&"indexing_error"!==d.requestStatus?1e4:0),[d,()=>u()]}function _(e){let t=(0,a.jE)(),s=(0,l.useCallback)(()=>Promise.resolve(t.invalidateQueries({queryKey:["repo-indexing-state",e]})),[t,e]),r=(0,o.I)({queryKey:["copilot-chat","repo-indexing-state",e],queryFn:()=>w(e),placeholderData:{requestStatus:"unknown",code:"unknown",docs:"unknown"},staleTime:1/0}),{mutate:i}=(0,n.n)({mutationKey:["repo-indexing-state"],mutationFn:()=>C([e]),onSuccess:s}),c=r.data;return O(()=>void s(),"indexing"===c.code&&"indexing_error"!==c.requestStatus?1e4:0),[c,()=>i()]}function S(e){let t=(0,o.I)({queryKey:["copilot-chat","repos-indexing-state",e],queryFn:()=>I(e),staleTime:1/0});return!t.isError&&!!t.data?.canChat}function y(){let e=c.J.getPanelHeight(),t=c.J.getPanelWidth(),s=(0,l.useRef)(null),r=(0,l.useRef)(e),a=(0,l.useRef)(e),i=(0,l.useRef)(null),n=(0,l.useRef)(t),o=(0,l.useRef)(t),[u,d]=(0,l.useState)(e),[h,p]=(0,l.useState)(t),f=(0,l.useRef)(0);(0,l.useEffect)(()=>{f.current=parseFloat(getComputedStyle(document.documentElement).fontSize)},[]);let E=e=>Math.min(Math.max(e,m),window.innerHeight-f.current),_=e=>Math.min(Math.max(e,g),window.innerWidth-2*f.current),S=(0,l.useCallback)(e=>{if(null!==s.current){let t=s.current-e.clientY,i=E(r.current+t);d(i),a.current=i}if(null!==i.current){let t=i.current-e.clientX,s=_(n.current+t);p(s),o.current=s}},[]),y=(0,l.useCallback)(()=>{window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",y),null!==s.current&&(c.J.setPanelHeight(a.current),s.current=null),null!==i.current&&(c.J.setPanelWidth(o.current),i.current=null)},[S]),T=(0,l.useCallback)((e,t,a)=>{0===e.button&&(e.preventDefault(),a&&(s.current=e.clientY,r.current=u),t&&(i.current=e.clientX,n.current=h),window.addEventListener("mousemove",S),window.addEventListener("mouseup",y))},[u,h,S,y]),w=(0,l.useCallback)(e=>{if("ArrowUp"===e.key){let t=E(u+4);d(t),c.J.setPanelHeight(t),e.preventDefault()}else if("ArrowDown"===e.key){let t=E(u-4);d(t),c.J.setPanelHeight(t),e.preventDefault()}else if("ArrowRight"===e.key){let t=_(h-4);p(t),c.J.setPanelWidth(t),e.preventDefault()}else if("ArrowLeft"===e.key){let t=_(h+4);p(t),c.J.setPanelWidth(t),e.preventDefault()}},[u,h]);return{panelWidth:h,panelHeight:u,startResize:T,onResizerKeyDown:w}}function T(e){let[t,s]=(0,l.useState)({}),r=(0,u.qY)();return(0,l.useEffect)(()=>{e&&(r?.current?.clientWidth||480)+480>=window.innerWidth?s({left:`${window.innerWidth-(r?.current?.clientWidth||480)}px !important`,bottom:"64px"}):s({})},[e,r]),t}async function w(e){let t=await fetch(`/search/check_indexing_status?nwo=${encodeURIComponent(e)}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)return{requestStatus:"request_failed",code:"unknown",docs:"unknown"};let s=await t.json();return{requestStatus:s.can_index,code:s.code_status,docs:s.docs_status,remainingRepoIndexTokens:s.remaining_repo_index_tokens}}async function C(e){let t=1===e.length?`nwo=${encodeURIComponent(e[0])}`:`nwos=${encodeURIComponent(JSON.stringify(e))}`;return(0,r.DI)(`/search/index_embeddings?${t}&index_code=true`,{method:"POST"})}async function I(e){let t=await fetch(`/github-copilot/docs/docsets/kb_indexed_repos?ids=${encodeURIComponent(JSON.stringify(e))}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});return t.ok?await t.json():{canChat:!1}}function R(e){return e.every(e=>"indexed"===e)?"indexed":e.every(e=>"not_indexed"===e)?"not_indexed":e.some(e=>"indexing"===e)?"indexing":e.some(e=>"not_indexed"===e)?"partially_indexed":"unknown"}function O(e,t){let s=(0,l.useRef)(void 0),r=(0,l.useRef)(e);return(0,l.useEffect)(()=>{r.current=e},[e]),(0,l.useEffect)(()=>{if(t>0)return s.current=window.setInterval(()=>r.current(),t),()=>window.clearInterval(s.current)},[t]),s}},64575:(e,t,s)=>{s.d(t,{X:()=>CopilotChatMessageStreamer});let r=/^data:\s+/;let CopilotStreamingError=class CopilotStreamingError extends Error{constructor(e){super(e.description),this.error=e,this.name="CopilotStreamingError"}};let CopilotChatMessageStreamer=class CopilotChatMessageStreamer{async *stream(){let e=new TextDecoder("utf-8"),t="";for(;;){let s,a;try{({value:s,done:a}=await this.reader.read())}catch{throw new CopilotStreamingError({type:"error",errorType:"networkError",description:"NETWORK_CONNECTION_INTERRUPTED"})}if(a)break;for(t+=e.decode(s);;){let e=t.indexOf("\n\n");if(-1===e)break;let s=t.slice(0,e).replace(r,"");if("[DONE]"===s)return;let a=JSON.parse(s);if(yield a,a?.type==="complete")return;t=t.slice(e+2)}}}async stop(){return this.reader.cancel()}constructor(e){this.reader=e}}},96335:(e,t,s)=>{s.d(t,{k:()=>CopilotChatService});var r=s(66444),a=s(22942),i=s(4227),n=s(46335),o=s(85749),l=s(38253),c=s(3004),u=s(94194);let d=new Set(["snippet","file","symbol","docset","repository"]);let CopilotChatService=class CopilotChatService{async fetchThreads(e={}){let t=new URLSearchParams;"string"==typeof e.name&&t.set("name",e.name);let s=`/threads?${t.toString()}`,r=await this.makeCAPIRequest(s,"GET");if(!r.ok)return r;let a=(await r.json()).threads||[];return{status:r.status,ok:!0,payload:a}}async fetchLatestThread(e){let t=new URLSearchParams;"string"==typeof e&&t.set("thread_id",e);let s=await this.makeCAPIRequest(`/threads/latest?${t.toString()}`,"GET");if(!s.ok)return s;let r=(await s.json()).thread;return{status:s.status,ok:!0,payload:r}}async createThread(){let e=await this.makeCAPIRequest("/threads","POST");if(!e.ok)return e;let t=(await e.json()).thread;return{status:e.status,ok:!0,payload:t}}async deleteThread(e){let t=await this.makeCAPIRequest(`/threads/${e}`,"DELETE");return t.ok?{status:t.status,ok:!0,payload:null}:t}async deleteAllThreads(e){let t=await this.makeCAPIRequest("/threads","DELETE",e);return t.ok?{status:t.status,ok:!0,payload:null}:t}async renameThread(e,t){let s=await this.makeCAPIRequest(`/threads/${e}/name`,"PATCH",{generate:!1,name:t});if(!s.ok)return s;let r=(await s.json()).name||"";return{status:s.status,ok:!0,payload:r}}async clearThread(e){let t=await this.makeCAPIRequest(`/threads/${e}/clear`,"PATCH");return t.ok?{status:t.status,ok:!0,payload:null}:t}async shareThread(e){let t=await this.makeCAPIRequest(`/threads/${e}/share`,"PATCH");if(!t.ok)return t;let s=(await t.json()).thread;return{status:t.status,ok:!0,payload:s}}async generateThreadName(e){let t=await this.makeCAPIRequest(`/threads/${e}/name`,"PATCH",{generate:!0,name:""});if(!t.ok)return t;let s=(await t.json()).name||"";return{status:t.status,ok:!0,payload:s}}async getSystemPrompt(e){let t=await this.makeCAPIRequest(`/system_prompt/${e}`,"GET");if(!t.ok)return t;let s=await t.json();return{status:t.status,ok:!0,payload:s}}async listMessages(e){if(this.listMessagesCache?.thread.id===e)return{status:200,ok:!0,payload:this.listMessagesCache};let t=await this.makeCAPIRequest(`/threads/${e}/messages`,"GET");if(!t.ok)return t;let s=await t.json();return this.listMessagesCache=s,{status:t.status,ok:!0,payload:s}}async listSharedThreadMessages(e){let t=await this.makeCAPIRequest(`/shared/${e}/messages`,"GET");if(!t.ok)return t;let s=await t.json();return{status:t.status,ok:!0,payload:s}}async createMessage(e,t,s,r,a,i){this.listMessagesCache=void 0;let n=await this.makeCAPIRequest(`/threads/${e}/messages`,"POST",{content:t,intent:s,references:r,currentURL:window.location.href,customInstructions:a,model:i,settings:c.J.settings??void 0});if(!n.ok)return n;let o=(await n.json()).message;return{status:n.status,ok:!0,payload:o}}async createMessageStreaming(e,t,s,r,a,i,n,o,l,u,d,h,p,m){this.listMessagesCache=void 0;let g={content:t,intent:s,references:a,context:i,currentURL:window.location.href,streaming:!0,confirmations:n,customInstructions:o,model:l,mode:r,settings:c.J.settings??void 0,customCopilotId:u,parentMessageID:d,tools:h,clientToolResults:p},f=this.processQueryParams(new URLSearchParams(window.location.search)),E=await this.makeCAPIRequest(`/threads/${e}/messages?${f.toString()}`,"POST",g,!0,void 0,m);return E.ok?{status:E.status,ok:!0,response:E}:E}processQueryParams(e){let t=["instruction_prompt"],s=new URLSearchParams;for(let[r,a]of e)t.includes(r)&&s.append(r,a);return s}async listModels(){let e=await this.makeCAPIRequest("/models","GET",void 0,!1,"");if(!e.ok)return e;let t=await e.json();return{status:e.status,ok:!0,payload:t.data}}async setModelPolicyState(e,t){let s=await this.makeCAPIRequest(`/models/${e}/policy`,"POST",{state:t},!1,"");if(!s.ok)return Promise.reject(Error(`Failed to update model policy state: ${s.status}`))}async sendFeedback({feedback:e,feedbackChoice:t,messageId:s,threadId:r,textResponse:a}){let i=await this.makeDotcomRequest(`${this.urlPathPrefix}/feedback`,"POST",{feedback:e,feedback_choice:t,message_id:s,thread_id:r,text_response:a});return i.ok?{status:i.status,ok:!0,payload:null}:i}async listDocsets(){let e=await this.fetchDocsetsResponse();return e.ok?{status:200,ok:!0,payload:e.payload.knowledgeBases}:e}async listAdministratedCopilotEnterpriseOrganizations(){let e=await this.fetchDocsetsResponse();return e.ok?{status:200,ok:!0,payload:e.payload.administratedCopilotEnterpriseOrganizations}:e}fetchDocsetsResponse(){return this.docsetsPromise||(this.docsetsPromise=this.docsetRequestPromise()),this.docsetsPromise}async docsetRequestPromise(){let e=await this.makeDotcomRequest("/github-copilot/docs/docsets","GET");return e.ok?{status:200,ok:!0,payload:await e.json()}:e}async deleteDocset(e){let t=await this.makeDotcomRequest(`/copilot/docsets/${e.id}`,"DELETE");return t.ok?{status:t.status,ok:!0,payload:null}:t}async listRepoFiles(e,t=!1){let s=(0,i.ClY)({repo:e,commitOid:e.commitOID,includeDirectories:t});return this.repoFilesCache.get(s)}async querySymbols(e,t){return await this.blackbirdCaches.setupWarmCachesLoop(),this.querySymbolsCache.get(e.ownerLogin,e.name,t)}async fetchImplicitContext(e,t,s){let r=await this.makeDotcomRequest(`${this.urlPathPrefix}/implicit-context/${t}/${s}/${encodeURIComponent(e)}`,"GET");return r.ok?{status:r.status,ok:r.ok,payload:await r.json()}:r}async fetchRepo(e){let t;if(this.repoDetailsCache.has(e))t=this.repoDetailsCache.get(e);else{let s=await this.makeDotcomRequest(`${this.urlPathPrefix}/repositories/${e}`,"GET");if(!s.ok)return s;t=await s.json(),this.repoDetailsCache.set(e,t)}return{status:200,ok:!0,payload:t}}async listAgents(e){let t=await (0,n.lS)(e);if(!t.ok)return{status:t.status,ok:!1,error:l.Sr[t.status]||l.DW};let s=await t.json();return{status:t.status,ok:t.ok,payload:s}}async listCustomCopilots(){let e=await (0,n.lS)(`${this.urlPathPrefix}/custom_copilots`);if(!e.ok)return{status:e.status,ok:!1,error:l.Sr[e.status]||l.DW};let t=await e.json();return{status:e.status,ok:!0,payload:t}}async hydrateReference(e){if(!d.has(e.type))return{status:204,ok:!0,payload:e};let t=await this.makeDotcomRequest(`${this.urlPathPrefix}/reference_details`,"POST",{reference:e});return t.ok?{status:t.status,ok:t.ok,payload:await t.json()}:t}async fetchLanguageForFileReference(e){let{repoOwner:t,repoName:s}=e,r=window.btoa(e.path),a=(0,i.RT3)({ownerLogin:t,name:s},r,!0),n=await this.makeDotcomRequest(a,"GET");return n.ok?{status:n.status,ok:n.ok,payload:await n.json()}:n}async makeDotcomRequest(e,t,s){let r={};for(let e of(0,u.f)()){let t=e.split("="),s=t[0]?.replaceAll("_","-"),a="1";t.length>1&&(a=t[1]),r[`X-Experiment-${s}`]=a}let a=await this.copilotAuthTokenProvider.getAuthToken();r["X-Copilot-Api-Token"]=a.value;try{let a=await (0,n.lS)(e,{method:t,body:s,headers:r});if(a.ok)return a;return{status:a.status,ok:!1,error:l.Sr[a.status]||l.DW}}catch{return{status:500,ok:!1,error:l.DW}}}get directConnectConfiguration(){return{integrationID:"copilot-chat"}}async makeCAPIRequest(e,t,s,r=!1,a="/github/chat",i){let n=this.apiURL,o=await this.copilotAuthTokenProvider.getAuthToken();return await (0,l.p)({basePath:n+a,path:e,method:t,body:s,streamingResponse:r,authToken:o,integrationId:this.directConnectConfiguration.integrationID,realIp:this.realIp,signal:i})}constructor(e,t,s){this.urlPathPrefix="/github-copilot/chat",this.docsetsPromise=void 0,this.repoDetailsCache=new Map,this.listMessagesCache=void 0,this.blackbirdCaches=new r.L,this.listRepoFilesImpl=async e=>{let t=await this.makeDotcomRequest(e,"GET");return t.ok?{status:200,ok:!0,payload:await t.json()}:t},this.repoFilesCache=new o.d(this.listRepoFilesImpl),this.querySymbolsImpl=async(e,t,s)=>{let r=await this.makeDotcomRequest(`/search/suggestions?query=repo:${e}/${t} ${s}`,"GET");return r.ok?{status:200,ok:!0,payload:(await r.json()).suggestions.filter(e=>"SUGGESTION_KIND_SYMBOL"===e.kind)}:r},this.querySymbolsCache=new o.d(this.querySymbolsImpl),this.apiURL=e,this.copilotAuthTokenProvider=new a.J(t.map(e=>e.id)),this.realIp=s||""}}},84569:(e,t,s)=>{s.d(t,{C6:()=>a,hs:()=>n,mF:()=>o,wh:()=>r,xP:()=>i});let r={explain:"explain",conversation:"conversation",suggest:"suggest",discussFileDiff:"discuss-file-diff",explainFileDiff:"explain-file-diff",reviewPr:"review-pull-request",actionsAgent:"actions-agent"},a=["exception","filtered","publicCode","contentTooLarge","rateLimit","agentUnauthorized","agentRequest","networkError","multipleAgentsAttempt"],i=["bing-search","codesearch","semanticsearch","lexicalsearch","kb-search","pathsearch","show-symbol-definition","getissue","getprcommits","getcommit","getrelease","getrepo","getdiff","get-diff-by-range","getfile","getfilechanges","getdiscussion","get-actions-job-logs","getpullrequest","getalert","planskill","get-github-data","support-search","kb-repo-search"];var n=function(e){return e.Experiments="experiements",e.Prompt="prompt",e.None="none",e}({}),o=function(e){return e.Unlicensed="unlicensed",e.LicensedFull="licensed_full",e.LicensedLimited="licensed_limited",e}({})},10411:(e,t,s)=>{s.d(t,{W:()=>a});var r=s(6051);let a=new class CopilotFeatureFlags{get embedding(){return(0,r.G7)("copilot_conversational_ux_embedding_update")}get unstickyReferences(){return(0,r.G7)("copilot_conversational_ux_history_refs")}get implicitContext(){return(0,r.G7)("COPILOT_IMPLICIT_CONTEXT")}get customInstructions(){return(0,r.G7)("copilot_chat_custom_instructions")}get reactMarkdown(){return(0,r.G7)("copilot_react_markdown")}get dotcomUserServerTokens(){return(0,r.G7)("copilot_chat_dotcom_user_server_tokens")}get immersiveFilePreview(){return(0,r.G7)("copilot_immersive_file_preview")}get immersiveIssuePreview(){return(0,r.G7)("copilot_immersive_issue_preview")}get magicKBs(){return(0,r.G7)("copilot_chat_magic_kbs")}get bringYourOwnKey(){return(0,r.G7)("copilot_byok")}get newReferencesUI(){return(0,r.G7)("copilot_new_references_ui")}get repoCustomInstructions(){return(0,r.G7)("copilot_chat_repo_custom_instructions")}get repoCustomInstructionsPreview(){return(0,r.G7)("copilot_chat_repo_custom_instructions_preview")}get copilotFreeLimitedUser(){return(0,r.G7)("copilot_free_limited_user")}get sharedTopicIndicator(){return(0,r.G7)("copilot_chat_shared_topic_indicator")}get sharedSSOBanner(){return(0,r.G7)("copilot_chat_shared_repo_sso_banner")}get copilotChatAttachImages(){return(0,r.G7)("copilot_chat_attach_images")}get copilotChatRetryOnError(){return(0,r.G7)("copilot_chat_retry_on_error")}get immersiveSubthreading(){return(0,r.G7)("copilot_chat_immersive_subthreading")}get copilotChatPersistSubmittedInput(){return(0,r.G7)("copilot_chat_persist_submitted_input")}get customCopilots(){return(0,r.G7)("copilot_custom_copilots")}get bypassIndexingQuota(){return(0,r.G7)("bypass_copilot_indexing_quota")}get reduceTelemetry(){return(0,r.G7)("copilot_dotcom_chat_reduce_telemetry")}get editorUpsells(){return(0,r.G7)("copilot_editor_upsells")}get shareConversation(){return(0,r.G7)("copilot_share_conversation")}get clientDOMSkills(){return(0,r.G7)("copilot_client_dom_skills")}get newMarkdownRenderer(){return(0,r.G7)("copilot_new_markdown_renderer")}get sharedChatInput(){return(0,r.G7)("copilot_chat_shared_chat_input")}get dotcomChatClientSideSkills(){return(0,r.G7)("dotcom_chat_client_side_skills")}get attachFolderReference(){return(0,r.G7)("copilot_attach_folder_reference")}}},3004:(e,t,s)=>{s.d(t,{J:()=>n});var r=s(45062),a=s(10943),i=s(38253);let CopilotLocalStorage=class CopilotLocalStorage{get selectedThreadID(){return this.localStorage.getItem(this.COPILOT_SELECTED_THREAD_ID_STORAGE_KEY)}set selectedThreadID(e){let t=this.COPILOT_SELECTED_THREAD_ID_STORAGE_KEY;if(null==e){this.localStorage.removeItem(t);return}this.localStorage.setItem(t,e)}getModel(e){let t=this.localStorage.getItem(this.COPILOT_SELECTED_MODEL_STORAGE_KEY(e));return null===t?t:JSON.parse(t)}setModel(e,t){this.localStorage.setItem(this.COPILOT_SELECTED_MODEL_STORAGE_KEY(e),JSON.stringify(t))}get settings(){let e=this.localStorage.getItem(this.COPILOT_SETTINGS_STORAGE_KEY(this.selectedThreadID));return null===e?e:JSON.parse(e)}set settings(e){this.localStorage.setItem(this.COPILOT_SETTINGS_STORAGE_KEY(this.selectedThreadID),JSON.stringify(e))}getPanelHeight(){let e=this.localStorage.getItem(this.COPILOT_PANEL_HEIGHT);return e?parseInt(e):this.DEFAULT_PANEL_HEIGHT}setPanelHeight(e){let t=this.COPILOT_PANEL_HEIGHT;this.localStorage.setItem(t,e.toString())}getPanelWidth(){let e=this.localStorage.getItem(this.COPILOT_PANEL_WIDTH);return e?parseInt(e):this.DEFAULT_PANEL_WIDTH}setPanelWidth(e){let t=this.COPILOT_PANEL_WIDTH;this.localStorage.setItem(t,e.toString())}getRepoCustomInstructionsState(){return"false"!==this.localStorage.getItem(this.COPILOT_REPO_CUSTOM_INSTRUCTIONS_STATE_KEY)}setRepoCustomInstructionsState(e){let t=this.COPILOT_REPO_CUSTOM_INSTRUCTIONS_STATE_KEY;this.localStorage.setItem(t,e.toString())}getCollapsedState(){return"false"!==this.sessionStorage.getItem(this.COPILOT_COLLAPSED_STATE_KEY)}setCollapsedState(e){let t=this.COPILOT_COLLAPSED_STATE_KEY;this.sessionStorage.setItem(t,e.toString())}getSelectedTopic(e){return this.localStorage.getItem(this.COPILOT_SELECTED_TOPIC_STORAGE_KEY(e))}setSelectedTopic(e,t){if(null==t){this.localStorage.removeItem(this.COPILOT_SELECTED_TOPIC_STORAGE_KEY(e));return}let s=this.COPILOT_SELECTED_TOPIC_STORAGE_KEY(e);this.localStorage.setItem(s,t)}getSavedMessage(e){return this.localStorage.getItem(this.COPILOT_SAVED_USER_MESSAGE_KEY(e))}setSavedMessage(e,t){this.setSavedMessageFast(e,t)}setSavedMessageFast(e,t){let s=this.COPILOT_SAVED_USER_MESSAGE_KEY(e);if(null==t){this.localStorage.removeItem(s);return}this.localStorage.setItem(s,t)}clearSavedUserMessage(e){this.localStorage.removeItem(this.COPILOT_SAVED_USER_MESSAGE_KEY(e))}getSavedUserMessageOnError(e){return this.localStorage.getItem(this.COPILOT_SAVED_USER_MESSAGE_ON_ERROR_KEY(e))}setSavedUserMessageOnError(e,t){let s=this.COPILOT_SAVED_USER_MESSAGE_ON_ERROR_KEY(e);if(null==t){this.localStorage.removeItem(s);return}this.localStorage.setItem(s,t)}clearSavedUserMessageOnError(e){this.localStorage.removeItem(this.COPILOT_SAVED_USER_MESSAGE_ON_ERROR_KEY(e))}getEntrypointMessage(){return this.localStorage.getItem(this.COPILOT_ENTRYPOINT_MESSAGE_KEY)}setEntrypointMessage(e){if(null==e){this.localStorage.removeItem(this.COPILOT_ENTRYPOINT_MESSAGE_KEY);return}this.localStorage.setItem(this.COPILOT_ENTRYPOINT_MESSAGE_KEY,e)}getCurrentReferences(e){let t=this.COPILOT_CURRENT_REFERENCES_KEY(e),s=this.localStorage.getItem(t);return s?JSON.parse(s):null}setCurrentReferences(e,t){let s=this.COPILOT_CURRENT_REFERENCES_KEY(e),r=t.filter((e,s)=>s===t.findIndex(t=>(0,i.Vb)(e)===(0,i.Vb)(t)));this.localStorage.setItem(s,JSON.stringify(r))}clearCurrentReferences(e){let t=this.COPILOT_CURRENT_REFERENCES_KEY(e);this.localStorage.removeItem(t)}migrateNullThreadToNewThread(e){let t=this.getSavedMessage(null);this.setSavedMessageFast(null,null),t&&this.setSavedMessage(e,t);let s=this.getCurrentReferences(null);this.clearCurrentReferences(null),s&&this.setCurrentReferences(e,s)}getImmersiveSidebarCollapsedState(){return"true"===localStorage.getItem(this.COPILOT_IMMERSIVE_SIDEBAR_COLLAPSED_STATE_KEY)}setImmersiveSidebarCollapsedState(e){localStorage.setItem(this.COPILOT_IMMERSIVE_SIDEBAR_COLLAPSED_STATE_KEY,String(e))}getMeterBannerFlag(){let e=this.localStorage.getItem("COPILOT_METER_BANNER_FLAG");return null===e?null:"true"===e}setMeterBannerFlag(e){this.localStorage.setItem("COPILOT_METER_BANNER_FLAG",String(e))}removeMeterBannerFlag(){this.localStorage.removeItem("COPILOT_METER_BANNER_FLAG")}constructor(){this.COPILOT_REPO_CUSTOM_INSTRUCTIONS_STATE_KEY="COPILOT_REPO_CUSTOM_INSTRUCTIONS_STATE_KEY",this.COPILOT_SELECTED_THREAD_ID_STORAGE_KEY="COPILOT_SELECTED_THREAD_ID_STORAGE_KEY",this.COPILOT_COLLAPSED_STATE_KEY="COPILOT_COLLAPSED_STATE_KEY",this.COPILOT_IMMERSIVE_SIDEBAR_COLLAPSED_STATE_KEY="COPILOT_IMMERSIVE_SIDEBAR_COLLAPSED_STATE_KEY",this.COPILOT_PANEL_HEIGHT="COPILOT_PANEL_HEIGHT",this.DEFAULT_PANEL_HEIGHT=600,this.COPILOT_PANEL_WIDTH="COPILOT_PANEL_WIDTH",this.COPILOT_ENTRYPOINT_MESSAGE_KEY="COPILOT_ENTRYPOINT_MESSAGE_KEY",this.DEFAULT_PANEL_WIDTH=480,this.COPILOT_SELECTED_MODEL_STORAGE_KEY=e=>`COPILOT_SELECTED_MODEL_${e}`,this.COPILOT_SETTINGS_STORAGE_KEY=e=>`COPILOT_SETTINGS_${e}`,this.COPILOT_SAVED_USER_MESSAGE_KEY=e=>`COPILOT_SAVED_USER_MESSAGE_${e}`,this.COPILOT_SAVED_USER_MESSAGE_ON_ERROR_KEY=e=>`COPILOT_SAVED_USER_MESSAGE_ON_ERROR_${e}`,this.COPILOT_CURRENT_REFERENCES_KEY=e=>`COPILOT_CURRENT_REFERENCES_${e}`,this.COPILOT_SELECTED_TOPIC_STORAGE_KEY=e=>`COPILOT_SELECTED_TOPIC_${e}`,this.localStorage=(0,a.A)("localStorage",{throwQuotaErrorsOnSet:!1,ttl:864e5}),this.sessionStorage=(0,a.A)("sessionStorage",{throwQuotaErrorsOnSet:!1,ttl:864e5})}};!function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);i>3&&n&&Object.defineProperty(t,s,n)}([(0,r.s)(100)],CopilotLocalStorage.prototype,"setSavedMessage",null);let n=new CopilotLocalStorage},94194:(e,t,s)=>{s.d(t,{R:()=>n,f:()=>i});var r=s(10943);let a="copilot_experiments";function i(){let e=(0,r.A)("localStorage").getItem(a);return e?e.split(","):[]}function n(e){(0,r.A)("localStorage").setItem(a,e.join(","))}},24538:(e,t,s)=>{s.d(t,{U:()=>n,e:()=>o});let r=["o1","o1-mini","o1-ga"],a="/images/modules/marketplace/models/families/openai.svg",i=new Map([["Azure OpenAI",a],["Anthropic","/images/modules/marketplace/models/families/anthropic.svg"],["Google","/images/modules/marketplace/models/families/gemini.svg"]]),n={capabilities:{family:"gpt-4o",limits:{max_prompt_tokens:2e4},supports:{parallel_tool_calls:!0,tool_calls:!0},tokenizer:"o200k_base",type:"chat"},id:"gpt-4o",name:"GPT 4o",version:"gpt-4o-2024-05-13",displayName:"GPT 4o",vendor:"Azure OpenAI",logoURL:a,hasLimitedCapabilities:!1,preview:!1,isThirdParty:!1,model_picker_enabled:!0};function o(e){return(e??[n]).map(l).filter(e=>!!e).filter(e=>e.model_picker_enabled)}function l(e){return"chat"===e.capabilities.type&&e.model_picker_enabled&&(!e.policy||"enabled"===e.policy.state||e.policy.terms)?{...e,displayName:function(e){for(let t of c)if(e.name.endsWith(t))return e.name.replace(t,"").trim();return e.name}(e),hasLimitedCapabilities:r.includes(e.capabilities.family),isThirdParty:"Azure OpenAI"!==e.vendor,logoURL:i.get(e.vendor)}:null}let c=["(Beta)","(Preview)"]},76513:(e,t,s)=>{s.d(t,{Pe:()=>i,oo:()=>a,y$:()=>n});var r=s(84569);function a(e){let t=null!=e?`failing job ${e}`:"this failing job";return`Please find a solution for ${t}. Use the logs, job definition, and any referenced files where the failure occurred. Keep your response focused on the solution and include code suggestions when appropriate.`}let i={"Languages & frameworks":["Show me Python beginner projects.","Explain Java's garbage collection.","Start me off with Node.js.","Introduce me to Django best practices."],"Tools & environments":["Set up a local development environment.","Demonstrate the basics of Docker.","Get me started with Git.","Recommend popular VS Code extensions."],"Open source & contribution":["Suggest 10 open source projects I can contribute to.","Walk me through the GitHub Pull Request flow.","How do I start my own open source project?","Guide me through contributing to React's codebase."],"Best practices & concepts":["Explain the SOLID principles of object-oriented design.","Introduce me to test-driven development.","Describe common design patterns.","Teach me about RESTful API design."],"Web development":["Guide me through creating a basic website.","Introduce HTML5 and CSS3 features.","Explain responsive web design.","Start me off with Tailwind CSS."],"Databases & data":["Get me started with SQL queries.","Recommend popular NoSQL databases.","How to back up a database?","Give a walkthrough on normalizing a database."],"Algorithms & data structures":["Teach me basic sorting algorithms.","Explain binary search trees.","Introduce me to graph algorithms.","What is a hash table?"],"Security & authentication":["Give a guide on basic web security.","Show me how to set up OAuth.","What's a JSON Web Token?","Describe common encryption techniques."],"Mobile development":["Kickstart my journey with Android development.","Introduce me to iOS app basics.","Recommend cross-platform mobile frameworks.","Give a guide to the app store submission process."],"Cloud & DevOps":["Start me off with AWS basics.","How do I deploy apps on Azure DevOps?","Introduce me to Kubernetes.","What are the basics of continuous integration/continuous deployment?"],"Frontend frameworks & libraries":["Get me started with React.","Walk me through Vue.js essentials.","What are some best practices in Angular development?","How do I use Svelte for web apps?"],"Performance & optimization":["Teach me about website performance optimization.","Explain database indexing benefits.","What are some tips to optimize JavaScript code?","Give a guide to efficient API caching."]},n={repository:[{question:"What questions can I ask?"},{question:"What does this repository do?"},{question:"How should I get started exploring this repo?"},{question:"Can you tell me about this repository?"}],issue:[{question:"Summarize this issue."},{question:"What are the main points being discussed here?"},{question:"Suggest next steps for this issue."}],alert:[{question:"Summarize this alert."}],file:[{question:"Explain this file."},{question:"Summarize this file for me."},{question:"How can I improve this file?"}],"pull-request":[{question:"Summarize this pull request."},{question:"What commits are included in this PR?"},{question:"Can you tell me about the changes in this PR?"}],discussion:[{question:"Summarize this discussion."},{question:"Summarize the comments made by user in a discussion."},{question:"What were some key decisions made in this discussion?"}],job:[{question:"Why did this job fail?",intent:r.wh.actionsAgent},{question:"How can I fix this build?",intent:r.wh.actionsAgent}],default:[{question:"What questions can I ask?"},{question:"What is the best way to get started with Copilot?"},{question:"How do I clone this repository?"},{question:"How do I revert a commit?"},{question:"How do I add myself as a reviewer?"},{question:"How do I create a repository?"}]}},91441:(e,t,s)=>{s.d(t,{K:()=>ReadLocalWorkspaceFileSkill});var r=s(10943),a=s(16142),i=s(90254);let ReadLocalWorkspaceFileSkill=class ReadLocalWorkspaceFileSkill{requiresConfirmation(){return!1}confirmationMessage(){return"Read the local workspace file"}static schema(){return{type:"function",function:{name:"read-local-workspace-file",description:"Read a local file. This can be used to read files on the user's local machine. It is the equivalent of running `cat` in the terminal. The file path is relative to the current directory.",parameters:{type:"object",required:["path","repository","pullRequest"],properties:{path:{type:"string",description:"The path to the file to read."},repository:{required:["ownerLogin","name"],type:"object",description:"the repository containing the file to read.",properties:{ownerLogin:{type:"string",description:"the owner of the repository."},name:{type:"string",description:"the name of the repository."}}},pullRequest:{type:"object",description:"the pull request containing the file to read.",required:["number","headSHA"],properties:{number:{type:"string",description:"the number of the pull request."},headSHA:{type:"string",description:"the head SHA of the pull request."}}}}}}}}assertDefined(e,t){if(null==e)throw Error(t)}validateArgs(){let e=JSON.parse(this.rawArguments);return this.assertDefined(e,"No parsed arguments found in raw arguments"),this.assertDefined(e.path,"No path found on parsed arguments"),this.assertDefined(e.repository,"No repository found on parsed arguments"),this.assertDefined(e.pullRequest,"No pullRequest found on parsed arguments"),this.assertDefined(e.repository.ownerLogin,"No ownerLogin found on repository"),this.assertDefined(e.repository.name,"No name found on repository"),this.assertDefined(e.pullRequest.number,"No number found on pullRequest"),this.assertDefined(e.pullRequest.headSHA,"No headSHA found on pullRequest"),e}getArguments(){let e=this.validateArgs(),{repository:t,pullRequest:s}=e;return{path:e.path.startsWith("./")?e.path.slice(2):e.path,repository:t,pullRequest:s}}async fetchBlob(e,t,s){try{let r=await this.blobService.getBlob(e,t.ownerLogin,s.number,t.name,s.headSHA);return r.ok&&r.payload.blobContents||""}catch{return""}}async execute(){try{let e=(0,r.A)("localStorage"),{path:t,repository:s,pullRequest:a}=this.getArguments(),n=await this.fetchBlob(t,s,a),o=`hadron-editor-file-deltas-v2/${s.ownerLogin}/${s.name}/${a.number}`,l=JSON.parse(e.getItem(o)||"{}"),c=(l||{diffs:[],sessionId:"",latestTimestamp:0}).diffs?.find(e=>e.path===t);if(!c)return{name:this.name,arguments:this.rawArguments,result:n};let u=(0,i.X6)(n??"",c.diff),d=!1===u?n:u;return{name:this.name,arguments:this.rawArguments,result:d}}catch(e){return{name:this.name,arguments:this.rawArguments,result:`Error: ${e instanceof Error?e.message:`Error executing ${this.name} skill`}`}}}constructor(e,t,s){this.id=e,this.name=t,this.rawArguments=s,this.blobService=new a.T}}},98063:(e,t,s)=>{let r;s.d(t,{BI:()=>p,Ti:()=>m,lA:()=>h});var a=s(70837),i=s(18679),n=s(10943),o=s(29583);let{getItem:l}=(0,n.A)("localStorage"),c="dimension_",u=["utm_source","utm_medium","utm_campaign","utm_term","utm_content","scid"];try{let e=(0,a.O)("octolytics");delete e.baseContext,r=new i.s(e)}catch{}function d(e){let t=(0,a.O)("octolytics").baseContext||{};if(t)for(let[e,s]of(delete t.app_id,delete t.event_url,delete t.host,Object.entries(t)))e.startsWith(c)&&(t[e.replace(c,"")]=s,delete t[e]);let s=document.querySelector("meta[name=visitor-payload]");for(let[e,r]of(s&&Object.assign(t,JSON.parse(atob(s.content))),new URLSearchParams(window.location.search)))u.includes(e.toLowerCase())&&(t[e]=r);return t.staff=(0,o.X)().toString(),Object.assign(t,e)}function h(e){r?.sendPageView(d(e))}function p(e,t={}){let s=document.head?.querySelector('meta[name="current-catalog-service"]')?.content,a=s?{service:s}:{};for(let[e,s]of Object.entries(t))null!=s&&(a[e]=`${s}`);r&&(d(a),r.sendEvent(e||"unknown",d(a)))}function m(e){return Object.fromEntries(Object.entries(e).map(([e,t])=>[e,JSON.stringify(t)]))}},73467:(e,t,s)=>{s.d(t,{J:()=>r});function r(e){let t=e.indexOf("/");if(-1===t||0===t)return`${e} in:name archived:false`;let s=e.slice(0,t),r=e.slice(t+1);return 0===r.length?`org:${s} in:name archived:false`:`org:${s} ${r} in:name archived:false`}},21503:(e,t,s)=>{function r(e,t,s){if(!t.has(e))throw TypeError("attempted to "+s+" private field on non-instance");return t.get(e)}function a(e,t){var s=r(e,t,"get");return s.get?s.get.call(e):s.value}function i(e,t,s){!function(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,s)}function n(e,t,s){var a=r(e,t,"set");return!function(e,t,s){if(t.set)t.set.call(e,s);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=s}}(e,a,s),s}s.d(t,{Es:()=>ObservableMap,Lj:()=>ObservableValue,yy:()=>ObservableSet});var o=new WeakMap;let l=class ObservableBase{subscribe(e){return a(this,o).add(e),()=>{a(this,o).delete(e)}}notify(e){for(let t of a(this,o))t(e)}constructor(){i(this,o,{writable:!0,value:void 0}),n(this,o,new Set)}};var c=new WeakMap;let ObservableValue=class ObservableValue extends l{get value(){return a(this,c)}set value(e){var t;t=a(this,c),("object"==typeof e&&e&&"object"==typeof t&&t?function(e,t){for(let s of new Set(Object.keys(e).concat(Object.keys(t))))if(!Object.is(e[s],t[s]))return!0;return!1}(t,e):!Object.is(t,e))&&(n(this,c,e),this.notify(e))}constructor(e){super(),i(this,c,{writable:!0,value:void 0}),n(this,c,e)}};var u=new WeakMap,d=new WeakMap;let ObservableSet=class ObservableSet extends l{get value(){return a(this,u)}has(e){if(!a(this,d).has(e)){let t=new ObservableValue(a(this,u).has(e));a(this,d).set(e,t)}return a(this,d).get(e)}add(e){a(this,u).has(e)||(a(this,u).add(e),a(this,d).has(e)&&(a(this,d).get(e).value=!0),this.notify(a(this,u)))}delete(e){a(this,u).has(e)&&(a(this,u).delete(e),a(this,d).has(e)&&(a(this,d).get(e).value=!1),this.notify(a(this,u)))}clear(){if(0!==a(this,u).size){for(let e of(a(this,u).clear(),a(this,d).values()))e.value=!1;this.notify(a(this,u))}}constructor(...e){super(),i(this,u,{writable:!0,value:void 0}),i(this,d,{writable:!0,value:void 0}),n(this,d,new Map),n(this,u,new Set(...e))}};var h=new WeakMap,p=new WeakMap,m=new WeakMap;let ObservableMap=class ObservableMap extends l{get value(){return a(this,h)}has(e){if(!a(this,p).has(e)){let t=new ObservableValue(a(this,h).has(e));a(this,p).set(e,t)}return a(this,p).get(e)}get(e){if(!a(this,m).has(e)){let t=new ObservableValue(a(this,h).get(e));a(this,m).set(e,t)}return a(this,m).get(e)}set(e,t){a(this,h).get(e)!==t&&(a(this,h).set(e,t),a(this,p).has(e)&&(a(this,p).get(e).value=!0),a(this,m).has(e)&&(a(this,m).get(e).value=t),this.notify(a(this,h)))}delete(e){a(this,h).has(e)&&(a(this,h).delete(e),a(this,p).has(e)&&(a(this,p).get(e).value=!1),a(this,m).has(e)&&(a(this,m).get(e).value=void 0),this.notify(a(this,h)))}clear(){if(0!==a(this,h).size){for(let e of(a(this,h).clear(),a(this,p).values()))e.value=!1;for(let e of a(this,m).values())e.value=void 0;this.notify(a(this,h))}}constructor(...e){super(),i(this,h,{writable:!0,value:void 0}),i(this,p,{writable:!0,value:void 0}),i(this,m,{writable:!0,value:void 0}),n(this,p,new Map),n(this,m,new Map),n(this,h,new Map(...e))}}},81299:(e,t,s)=>{s.d(t,{AI:()=>i,HN:()=>l,R:()=>n,Rs:()=>o,Sk:()=>u,tQ:()=>c});var r=s(96540),a=s(21503);function i(e){let[t]=(0,r.useState)(()=>new a.Lj(e));return t}function n(...e){let[t]=(0,r.useState)(()=>new a.Es(...e));return t}function o(e,t){let s=(0,r.useRef)(t);(0,r.useEffect)(()=>{s.current=t}),(0,r.useEffect)(()=>e.subscribe(e=>s.current(e)),[e])}function l(e){let[t,s]=(0,r.useState)(e.value);return o(e,e=>s(e)),t}function c(e){let[t,s]=(0,r.useState)(e.value),[a,i]=(0,r.useState)({});return o(e,e=>{s(e),i({})}),t}function u(e,t){let s=i(t(e.value));return o(e,e=>{s.value=t(e)}),s}},7025:(e,t,s)=>{s.d(t,{$:()=>d,x:()=>h});var r=s(74848),a=s(46335),i=s(97665),n=s(97286),o=s(96540),l=s(84569),c=s(10411);let CopilotChatEntitlement=class CopilotChatEntitlement{isLicensed(){return this.licenseType&&this.licenseType!==l.mF.Unlicensed}chatQuotaRemaining(){return this.quotas?.remaining.chat??0}constructor(e,t){this.licenseType=e,this.quotas=t}};let u=(0,o.createContext)(void 0);function d({children:e,initialLicenseType:t,initialQuotas:s}){let[d,h]=function(e,t){let s=(0,i.jE)(),r=(0,o.useCallback)(()=>s.invalidateQueries({queryKey:["copilot-chat","entitlement"]}),[s]),{data:u}=(0,n.I)({queryKey:["copilot-chat","entitlement"],queryFn:async()=>{let e=await (0,a.lS)("/github-copilot/chat/entitlement");if(!e.ok)throw Error(`Failed to retrieve Copilot chat entitlement (${e.status} on ${e.url})`);return await e.json()},enabled:c.W.copilotFreeLimitedUser&&e===l.mF.LicensedLimited,placeholderData:{licenseType:e,quotas:t},staleTime:3e5}),d=u?.licenseType??e,h=(0,o.useCallback)(()=>{c.W.copilotFreeLimitedUser&&d===l.mF.LicensedLimited&&r()},[r,d]);return[new CopilotChatEntitlement(d,u?.quotas),h]}(t,s),p=d.licenseType,m=c.W.copilotFreeLimitedUser?d.chatQuotaRemaining()??1/0:1/0,g=c.W.copilotFreeLimitedUser&&d.quotas?.resetDate?new Date(d.quotas.resetDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"",f=!!c.W.copilotFreeLimitedUser&&p===l.mF.LicensedLimited,E=!!c.W.copilotFreeLimitedUser&&f&&m<=0,_=(0,o.useMemo)(()=>({licenseType:p,chatQuotaRemaining:m,resetDate:g,isLicensedLimited:f,chatQuotaExceeded:E,reloadQuota:h}),[p,m,g,f,E,h]);return(0,r.jsx)(u.Provider,{value:_,children:e})}let h=()=>{let e=(0,o.useContext)(u);if(!e)throw Error("useEntitlement must be used within EntitlementProvider");return e};try{u.displayName||(u.displayName="EntitlementContext")}catch{}try{d.displayName||(d.displayName="EntitlementProvider")}catch{}},70368:(e,t,s)=>{s.d(t,{A:()=>c,c:()=>u});var r=s(74848),a=s(96540),i=s(38253),n=s(10411);let CopilotAutocompleteManager=class CopilotAutocompleteManager{filenameFromPath(e){let t=e.split("/");return t[t.length-1]}async fetchAutocompleteSuggestions(e,t){let[s,r]=await Promise.all([this.manager.service.querySymbols(e,t),this.manager.service.listRepoFiles(e,n.W.attachFolderReference)]);if(s.ok){let t=s.payload.flatMap(t=>t.symbol?[(0,i.Qt)(t,e)]:[]);this.symbolSuggestions=new Map(t.map(e=>[e.name,e]))}if(this.repoFileSuggestions.has(e.name)){this.fileSuggestions=this.repoFileSuggestions.get(e.name);return}if(r.ok){let t=new Map,s=new Map;this.repoFileSuggestions.set(e.name,t);let a=0,n=[...(r.payload.paths||[]).map(e=>({type:"path",path:e})),...(r.payload.directories||[]).map(e=>({type:"folder",path:e}))],o=()=>{let r=Math.min(a+5e3,n.length);for(;a<r;a++){let r=n[a];if(r?.type==="path"){let s=(0,i.iW)(r.path,e);t.set(s.path,s)}else if(r?.type==="folder"){let t=(0,i.OC)(r.path,e);s.set(t.path,t)}}if(a<n.length)setTimeout(o,0);else{this.fileSuggestions=t,this.folderSuggestions=s;return}};o()}}findReference(e,t){return t.currentReferences.find(t=>e===(0,i.Vb)(t))}async addToReferences(e,t){let s=(0,i.Vb)(e);if(this.findReference(s,t))return;let r=e;if((0,i.SI)(e)){let t=await this.manager.service.fetchLanguageForFileReference(e);if(t.ok&&t.payload.language){let{languageName:s,languageId:a}=t.payload.language;r={...e,languageName:s,languageId:a}}}this.manager.addReference(r,"autocomplete")}constructor(e){this.fileSuggestions=new Map,this.folderSuggestions=new Map,this.symbolSuggestions=new Map,this.knowledgeSuggestions=new Map,this.repoFileSuggestions=new Map,this.manager=e}};var o=s(26973);let l=(0,a.createContext)(null);function c({children:e}){let t=(0,o.b)(),s=(0,a.useMemo)(()=>new CopilotAutocompleteManager(t),[t]);return(0,r.jsx)(l.Provider,{value:s,children:e})}function u(){return(0,a.useContext)(l)}try{l.displayName||(l.displayName="CopilotChatAutocompleteContext")}catch{}try{c.displayName||(c.displayName="CopilotChatAutocompleteProvider")}catch{}},2982:(e,t,s)=>{s.d(t,{Jf:()=>D,Mj:()=>L,IJ:()=>G,qY:()=>$,Pk:()=>P,pn:()=>M,A3:()=>N,bP:()=>x});var r=s(74848),a=s(81299),i=s(58790),n=s(6499),o=s(96540),l=s(18312),c=s(7025);let u=(0,s(10943).A)("sessionStorage");function d(e,t){return!!e&&"assistive"===t}let h="restored-chat-messages";var p=s(38253),m=s(98063),g=s(10411),f=s(3004);let E=(e,t)=>{let s=t=>{t&&(f.J.selectedThreadID=t);let s=f.J.getModel(t)?.id,r=e.availableModels?.find(e=>e.id===s)??e.model;return{...e,model:r,selectedThreadID:t,currentView:"thread",showTopicPicker:!t&&e.showTopicPicker}},r=t=>(f.J.setCurrentReferences(e.selectedThreadID,t),{...e,currentReferences:t});switch(t.type){case"SLASH_COMMANDS_ERROR":return(0,m.BI)("copilot.slash_commands_error"),{...e,slashCommandLoading:{...e.slashCommandLoading,state:"error"}};case"SLASH_COMMANDS_LOADED":return(0,m.BI)("copilot.slash_commands_loaded"),{...e,slashCommandLoading:{...e.slashCommandLoading,state:"loaded"}};case"SLASH_COMMANDS_LOADING":return g.W.reduceTelemetry||(0,m.BI)("copilot.slash_commands_loading"),{...e,slashCommandLoading:{...e.slashCommandLoading,state:"loading"}};case"OPEN_COPILOT_CHAT":return(0,m.BI)("copilot.open_copilot_chat",{source:t.source}),{...e,chatIsOpen:!0,chatIsVisible:!0,entryPointId:t.id};case"CLOSE_COPILOT_CHAT":return(0,m.BI)("copilot.close_copilot_chat"),{...e,chatIsOpen:!1};case"HIDE_COPILOT_CHAT":return(0,m.BI)("copilot.hide_copilot_chat"),{...e,chatIsVisible:!1};case"THREAD_CREATED":return(0,m.BI)("copilot.thread_created",{...S(t.thread),mode:e.mode,count:e.threads.size+1}),{...s(t.thread.id),threads:new Map(e.threads.set(t.thread.id,t.thread))};case"SUGGESTIONS_GENERATED":return{...e,suggestions:t.suggestions};case"CLEAR_SUGGESTIONS":return{...e,suggestions:null};case"CLEAR_THREAD":return(0,m.BI)("copilot.clear_thread"),{...e,messages:[],currentReferences:[]};case"CLEAR_REFERENCES":return g.W.reduceTelemetry||(0,m.BI)("copilot.clear_references"),{...e,currentReferences:e.currentReferences.filter(e=>"docset"===e.type||"magic-knowledge-base"===e.type)};case"CLEAR_CURRENT_REFERENCES":return(0,m.BI)("copilot.clear_current_references"),{...e,currentReferences:[]};case"MESSAGES_UPDATED":if("error"!==t.state&&g.W.reduceTelemetry||(0,m.BI)("copilot.messages_updated",{count:t.messages?.length,loading:t.state}),!t.messages)return{...e,messagesLoading:{...e.messagesLoading,state:t.state}};{let s=e.defaultRecipient,r=e.allClientConfirmations;return"loaded"===t.state&&t.messages.length>0&&(s=w(t.messages[t.messages.length-1],e),r=t.messages.map(e=>e.clientConfirmations?.map(e=>JSON.stringify(Object.values(e.confirmation).sort()))).flat().filter(Boolean)),{...e,defaultRecipient:s,allClientConfirmations:r,messages:t.messages,messagesLoading:{...e.messagesLoading,state:t.state},messagesRestored:!1}}case"WAITING_ON_COPILOT":return g.W.reduceTelemetry||(0,m.BI)("copilot.waiting_on_copilot",{isWaitingOnCopilot:t.loading}),{...e,isWaitingOnCopilot:t.loading};case"SELECT_THREAD":return(0,m.BI)("copilot.select_thread",{threadID:t.thread?.id,mode:e.mode}),{...s(t.thread?.id||null),currentTopic:t.clearTopic?void 0:e.currentTopic,topicLoading:t.clearTopic?{error:null,state:"loaded"}:e.topicLoading};case"HANDLE_EVENT_START":return(0,m.BI)("copilot.handle_event_start"),{...t.references?r(t.references):e,chatIsOpen:!0,chatIsVisible:!0,entryPointId:t.id};case"THREADS_LOADING":return g.W.reduceTelemetry||(0,m.BI)("copilot.threads_loading"),{...e,threadsLoading:{...e.threadsLoading,state:"loading"}};case"DISMISS_ATTACH_KNOWLEDGE_BASE_HERE_POPOVER":return(0,m.BI)("copilot.dismiss_attach_knowledge_base_here_popover"),{...e,renderAttachKnowledgeBaseHerePopover:!1};case"DISMISS_KNOWLEDGE_BASE_ATTACHED_TO_CHAT_POPOVER":return(0,m.BI)("copilot.dismiss_knowledge_base_attached_to_chat_popover"),{...e,renderKnowledgeBaseAttachedToChatPopover:!1};case"KNOWLEDGE_BASES_LOADING":return g.W.reduceTelemetry||(0,m.BI)("copilot.knowledge_bases_loading"),{...e,knowledgeBasesLoading:{...e.knowledgeBasesLoading,state:"loading"}};case"KNOWLEDGE_BASES_LOADED":return(0,m.BI)("copilot.knowledge_bases_loaded",{count:t.knowledgeBases.length}),{...e,knowledgeBases:t.knowledgeBases,knowledgeBasesLoading:{...e.knowledgeBasesLoading,state:"loaded",error:null}};case"KNOWLEDGE_BASES_LOADING_ERROR":return(0,m.BI)("copilot.knowledge_bases_loading_error",{error:t.message}),{...e,knowledgeBasesLoading:{...e.knowledgeBasesLoading,state:"error",error:t.message}};case"LATEST_THREAD_LOADED":return{...e,threads:new Map(e.threads.set(t.latestThread.id,t.latestThread))};case"THREADS_LOADED":return(0,m.BI)("copilot.threads_loaded",{count:t.threads.length,mode:e.mode}),{...e,threadsLoading:{...e.threadsLoading,state:"loaded"},threads:new Map(t.threads.map(e=>[e.id,e]))};case"THREADS_LOADING_ERROR":return(0,m.BI)("copilot.threads_loading_error",{error:t.message}),{...e,threadsLoading:{error:t.message,state:"error"}};case"DELETE_THREAD_KEEP_SELECTION":return(0,m.BI)("copilot.thread_deleted",{...S(t.thread),count:e.threads.size-1}),e.threads.delete(t.thread.id),{...s(null),threads:new Map(e.threads),threadsLoading:{...e.threadsLoading,state:"loaded"},messages:[],messagesLoading:{state:"loaded",error:null},currentReferences:[],currentView:"list"};case"DELETE_ALL_THREADS_KEEP_SELECTION":for(let s of t.threads)(0,m.BI)("copilot.thread_deleted",{...S(s),count:e.threads.size-1}),e.threads.delete(s.id);return{...s(null),threads:new Map(e.threads),threadsLoading:{...e.threadsLoading,state:"loaded"},messages:[],messagesLoading:{state:"loaded",error:null},currentReferences:[],currentView:"list"};case"DELETE_THREAD":if((0,m.BI)("copilot.thread_deleted",{...S(t.thread),count:e.threads.size-1,mode:e.mode}),e.threads.delete(t.thread.id),e.selectedThreadID===t.thread.id)return{...s(null),threads:new Map(e.threads),threadsLoading:{...e.threadsLoading,state:"loaded"},messages:[],messagesLoading:{state:"loaded",error:null},currentReferences:[]};return{...e,threads:new Map(e.threads)};case"DELETE_THREAD_ERROR":return(0,m.BI)("copilot.delete_thread_error",{...S(t.thread),error:t.error}),{...e,threadsLoading:{...e.threadsLoading,error:t.error},threads:new Map(e.threads.set(t.thread.id,t.thread))};case"DELETE_ALL_THREADS_ERROR":{for(let e of t.threads)(0,m.BI)("copilot.delete_thread_error",{...S(e),error:t.error});let s=new Map(e.threads);for(let e of t.threads)s.set(e.id,e);return{...e,threadsLoading:{...e.threadsLoading,error:t.error},threads:s}}case"MESSAGE_ADDED":return(0,m.BI)("copilot.message_added",{..._(t.message),count:e.messages.length+1,repoHasCustomInstructions:!!t.repoHasCustomInstructions,usedRepoCustomInstructions:!!t.usedRepoCustomInstructions}),{...e,messages:[...e.messages,t.message]};case"THREAD_UPDATED":return g.W.reduceTelemetry||(0,m.BI)("copilot.thread_updated",S(t.thread)),{...e,...s(t.thread.id),threads:new Map(e.threads.set(t.thread.id,t.thread))};case"REFERENCES_LOADED":return(0,m.BI)("copilot.references_loaded",{count:t.references.length}),{...e,currentReferences:t.references};case"ADD_REFERENCE":return(0,m.BI)("copilot.add_reference",{...y(t.reference),source:t.source,count:e.currentReferences.length+1}),{...e,...r([...e.currentReferences.filter(e=>!(0,p.x_)(e,t.reference)),t.reference])};case"REMOVE_REFERENCES":{let s=t.referenceIndexes.map(t=>e.currentReferences[t]).filter(e=>!!e);return s.length>0&&(0,m.BI)("copilot.remove_reference",{types:s.filter((e,s)=>t.referenceIndexes.includes(s)).map(e=>e.type).join(","),count:e.currentReferences.length-s.length}),{...r(e.currentReferences.filter((e,s)=>!t.referenceIndexes.includes(s)))}}case"SHOW_TOPIC_PICKER":return{...e,showTopicPicker:t.show};case"CURRENT_TOPIC_UPDATED":return t.topic&&(0,m.BI)("copilot.current_topic_updated",{type:t.topic?(0,p.P)(t.topic)?"docset":"repository":"none",mode:e.mode}),{...e,currentTopic:t.topic,topicLoading:{...e.topicLoading,state:t.state}};case"MESSAGE_STREAMING_STARTED":return g.W.reduceTelemetry||(0,m.BI)("copilot.message_streaming_started",{..._(t.message),count:e.messages.length}),{...e,isWaitingOnCopilot:!0,streamingMessage:t.message,messages:[...e.messages]};case"MESSAGE_STREAMING_TOKEN_ADDED":return{...e,streamingMessage:e.streamingMessage?{...e.streamingMessage,content:e.streamingMessage.content+t.token}:null};case"MESSAGE_STREAMING_FUNCTION_CALLED":if(e.streamingMessage){let s=e.streamingMessage.skillExecutions||[],r=s.findIndex(e=>"started"===e.status),a=r>=0?s[r]:null,i=s;switch(t.status){case"started":i=[...s,{slug:t.name,status:t.status,arguments:t.arguments,errorMessage:t.errorMessage,references:[]}];break;case"completed":a&&(i[r]={...a,status:t.status,references:t.references});break;case"error":a&&(i[r]={...a,status:t.status,errorMessage:t.errorMessage})}return{...e,streamingMessage:{...e.streamingMessage,skillExecutions:i}}}return e;case"READ_DOM_SKILL_INVOKED":return{...e,elementMap:t.elementMap};case"MESSAGE_STREAMING_COMPLETED":{let s,r=e.defaultRecipient;return e.streamingMessage&&(r=w(s={...e.streamingMessage,id:t.messageResponse.id,references:t.messageResponse.references,createdAt:t.messageResponse.createdAt,intent:t.messageResponse.intent,copilotAnnotations:t.messageResponse.copilotAnnotations},e),(0,m.BI)("copilot.message_streaming_completed",{..._(s),...T(t.timings),model:e.model?.id,mode:e.mode,count:e.messages.length+1})),{...e,defaultRecipient:r,isWaitingOnCopilot:!1,streamingMessage:null,messages:s?[...e.messages,s]:e.messages}}case"MESSAGE_STREAMING_FAILED":return(0,m.BI)("copilot.message_streaming_failed",{...e.streamingMessage?_(e.streamingMessage):{},...T(t.timings),model:e.model?.id,mode:e.mode}),{...e,isWaitingOnCopilot:!1,streamingMessage:null};case"MESSAGE_STREAMING_STOPPED":{let s;return e.streamingMessage?(s={...e.streamingMessage,interrupted:!0},(0,m.BI)("copilot.message_streaming_stopped",{..._(s),...T(t.timings),model:e.model?.id,mode:e.mode,count:e.messages.length+1})):e.isWaitingOnCopilot&&(s={id:crypto.randomUUID(),role:"assistant",threadID:e.selectedThreadID??"",references:[],createdAt:new Date().toISOString(),interrupted:!0}),{...e,isWaitingOnCopilot:!1,streamingMessage:null,messages:s?[...e.messages,s]:e.messages}}case"MESSAGES_CLEAR_LAST_ERROR":{let t=e.messages[e.messages.length-1],s=t?.error||t?.interrupted?e.messages.slice(0,-1):e.messages;return{...e,streamingMessage:null,messages:s}}case"SELECT_REFERENCE":return t.reference&&(0,m.BI)("copilot.select_reference",y(t.reference)),{...e,selectedReference:t.reference};case"MODELS_LOADING":return{...e,modelsLoading:{state:"loaded",error:null}};case"MODELS_LOADING_ERROR":return{...e,modelsLoading:{state:"error",error:t.error}};case"MODELS_LOADED":return{...e,availableModels:t.models};case"SELECT_MODEL":if("immersive"!==e.mode)return e;return(0,m.BI)("copilot.select_model",{model:t.model?.name,mode:e.mode}),{...e,model:t.model};case"VIEW_ALL_THREADS":return{...e,currentView:"list"};case"VIEW_CURRENT_THREAD":return{...e,currentView:"thread"};case"IMPLICIT_CONTEXT_UPDATED":if(!(0,p.yR)(t.context,e.context))return{...e,context:t.context};return e;case"SET_TOP_REPOSITORIES":return{...e,topRepositoriesCache:t.topics};case"SET_AGENTS":return{...e,agents:t.agents};case"SET_CUSTOM_COPILOTS":return{...e,customCopilots:t.customCopilots};case"SET_CUSTOM_COPILOT_ID":return{...e,customCopilotId:t.customCopilotId};case"MESSAGE_STREAMING_CONFIRMATION":{let s={title:t.title,message:t.message,confirmation:t.confirmation};return{...e,streamingMessage:e.streamingMessage?{...e.streamingMessage,confirmations:e.streamingMessage.confirmations?[...e.streamingMessage.confirmations,s]:[s]}:null}}case"AGENT_ERROR":{let s=e.streamingMessage,r=t.error;return{...e,streamingMessage:s&&{...s,agentErrors:[...s.agentErrors??[],{type:r.type,code:r.code,message:r.message,identifier:r.identifier}]}}}case"ENTITLEMENT_UPDATED":return{...e,entitlement:t.entitlement??e.entitlement};case"TOGGLE_REPO_CUSTOM_INSTRUCTIONS":return(0,m.BI)("copilot.repo_custom_instructions_toggled",{isEnabling:!!t.value}),{...e,repoCustomInstructionsEnabled:t.value};case"DISMISS_EDITOR_UPSELL_BANNER":return{...e,isEditorUpsellBannerDismissed:!0}}};function _(e){var t;if(!e)return(0,m.Ti)({});let s={id:e.id,role:e.role,createdAt:e.createdAt,threadID:e.threadID,referenceCount:e.references?.length??0};return e.intent&&(s.intent=e.intent),e.error&&(s.error=e.error),e.copilotAnnotations&&(s.copilotAnnotations=function(e){if(e)return{CodeVulnerability:e.CodeVulnerability?.map(e=>({details:{type:e?.details?.type}})),PublicCodeReference:e.PublicCodeReference?.map(e=>({details:{license:e?.details?.license,language:e?.details?.language}}))}}(e.copilotAnnotations)),e.skillExecutions&&(s.skillExecutions=(t=e.skillExecutions)?t.map(e=>({slug:e?.slug,status:e?.status,argumentCount:e?.arguments?.length??0,errorMessage:e?.errorMessage,references:e?.references?.length??0})):[]),e.interrupted&&(s.interrupted=!0),(0,m.Ti)(s)}function S(e){return e?(0,m.Ti)({id:e.id,createdAt:e.createdAt,updatedAt:e.updatedAt,currentReferenceCount:e.currentReferences?.length??0}):(0,m.Ti)({})}function y(e){return e?(0,m.Ti)({type:e.type}):(0,m.Ti)({})}function T(e){let t={totalTime:e.endTime-e.startTime};return void 0!==e.firstByte&&(t.ttfb=e.firstByte-e.startTime),void 0!==e.firstToken&&(t.ttft=e.firstToken-e.startTime),t}function w(e,t){let s=(0,p.Th)(e,t.currentUserLogin);if("agent"===s.type)return s.name}var C=s(70368),I=s(26973),R=s(24538),O=s(64003);let A=(0,i.E7)(),D=(0,o.createContext)(null),v=(0,o.createContext)(null);function L({children:e,topic:t,login:s,apiURL:a,workerPath:i,threadId:n,refs:m,selectedReference:g,mode:_,ssoOrganizations:S,renderKnowledgeBases:y,renderAttachKnowledgeBaseHerePopover:T,renderKnowledgeBaseAttachedToChatPopover:w,customInstructions:O,chatIsOpen:D,chatIsVisible:L,chatVisibleSettingPath:k,renderBetaLabel:P,agentsPath:M,optedInToPreviewFeatures:N,optedInToUserFeedback:x,agents:G,customCopilots:$,messages:U,testReducerState:q,reviewLab:W,realIp:H,currentView:B,hasCEorCBAccess:F,copilotUpsellBannerDismissed:j,licenseType:K,quotas:J}){let{restoredMessages:Y,restoredThreadTitle:V}=function(e,t){let s=d(e,t),r=u.getItem(h),a=r?JSON.parse(r):void 0;return((0,o.useEffect)(()=>{u.removeItem(h)},[]),s&&a?.expiry&&a.expiry>Date.now()&&a.threadId===e)?{restoredMessages:a.restoredMessages,restoredThreadTitle:a.threadTitle}:{}}(n,_),z=q||{threadsLoading:{state:"pending",error:null},messagesLoading:{state:"pending",error:null},messagesRestored:!!Y,slashCommandLoading:{state:"pending",error:null},showTopicPicker:"immersive"!==_&&(!n||"assistive"===_)&&!t,topicLoading:{state:"pending",error:null},threads:new Map,restoredThreadTitle:V,knowledgeBasesLoading:{state:"pending",error:null},knowledgeBases:[],model:R.U,availableModels:[R.U],modelsLoading:{state:"pending",error:null},messages:U??Y??[],streamer:null,streamingMessage:null,selectedThreadID:n,currentTopic:t,chatIsOpen:!!D,isWaitingOnCopilot:!1,currentUserLogin:s,apiUrl:a,currentReferences:m,findFileWorkerPath:i,currentView:B||"thread",selectedReference:g??null,mode:_,currentRepository:(0,p.Z6)(t)?t:void 0,ssoOrganizations:S,context:void 0,renderKnowledgeBases:y??!0,renderAttachKnowledgeBaseHerePopover:T,renderKnowledgeBaseAttachedToChatPopover:w,customInstructions:O,chatIsVisible:L,chatVisibleSettingPath:k,renderBetaLabel:P,topRepositoriesCache:void 0,agentsPath:M,optedInToPreviewFeatures:N,optedInToUserFeedback:x,agents:G,customCopilots:$,customCopilotId:void 0,suggestionsDismissed:!1,reviewLab:W,repoCustomInstructionsEnabled:f.J.getRepoCustomInstructionsState(),isEditorUpsellBannerDismissed:j},[X,Q]=(0,o.useReducer)(E,z);return!function(e,t,s,r){let a=d(t,r);(0,o.useEffect)(()=>{if(!a)return;let r=()=>{if(!e?.length||!t)return;let r=s.get(t),a=r?.name,i={expiry:Date.now()+8e3,restoredMessages:e,threadId:t,threadTitle:a};u.setItem(h,JSON.stringify(i))};return window.addEventListener("turbo:before-fetch-response",r),window.addEventListener("beforeunload",r),window.addEventListener("popstate",r),()=>{window.removeEventListener("turbo:before-fetch-response",r),window.removeEventListener("beforeunload",r),window.removeEventListener("popstate",r)}},[e,a,t,s])}(X.messages,X.selectedThreadID,X.threads,X.mode),(0,r.jsx)(c.$,{initialLicenseType:K,initialQuotas:J,children:(0,r.jsx)(b,{state:X,children:(0,r.jsx)(v.Provider,{value:Q,children:(0,r.jsx)(I.v,{apiURL:a,state:X,dispatch:Q,ssoOrganizations:S,realIp:H,hasCEorCBAccess:F,children:(0,r.jsx)(C.A,{children:(0,r.jsx)(l.RelayEnvironmentProvider,{environment:A,children:e})})})})})})}let k=(0,o.createContext)(null);function b({state:e,children:t}){let s=(0,a.AI)(e);return(0,n.N)(()=>{s.value=e},[e,s]),(0,r.jsx)(O.sw,{value:s,children:(0,r.jsx)(k.Provider,{value:e,children:t})})}function P(){let e=(0,o.useContext)(k);if(!e)throw Error("useChatState can only be used inside a CopilotChatProvider");return e}function M(e){let t=(0,O.rE)();if(!t)throw Error("useChatStateLens can only be used inside a CopilotChatProvider");let s=(0,a.Sk)(t,e);return(0,a.HN)(s)}function N(e){return M(t=>t[e])}function x(...e){return M(t=>(function(e,t){let s={};for(let r of t)s[r]=e[r];return s})(t,e))}function G(){let e=(0,o.useContext)(v);if(!e)throw Error("useChatDispatch can only be used inside a CopilotChatProvider");return e}function $(){return(0,o.useContext)(D)}try{D.displayName||(D.displayName="ChatPanelReferenceContext")}catch{}try{v.displayName||(v.displayName="CopilotChatDispatchContext")}catch{}try{L.displayName||(L.displayName="CopilotChatProvider")}catch{}try{k.displayName||(k.displayName="ChatStateContext")}catch{}try{b.displayName||(b.displayName="ChatStateProvider")}catch{}},26973:(e,t,s)=>{s.d(t,{b:()=>h,v:()=>d});var r=s(74848),a=s(70170),i=s(96540),n=s(31142),o=s(10411),l=s(3004),c=s(64003);let u=(0,i.createContext)(null);function d({apiURL:e,state:t,dispatch:s,ssoOrganizations:d,children:h,realIp:p,hasCEorCBAccess:m}){let g=(0,c.tD)(),f=(0,i.useMemo)(()=>new n.e8(s,e,d,g,p,void 0,m),[s,e,d,g,p,m]);return(0,i.useEffect)(()=>{t.chatIsOpen&&(async()=>{if(t.selectedThreadID&&t.messages.length>0&&!t.currentTopic){let e=l.J.getSelectedTopic(t.selectedThreadID),s=Number(e);e&&!isNaN(s)?await f.fetchCurrentRepo(s):f.clearCurrentTopic()}})()},[t.selectedThreadID,f,t.messages.length,t.currentTopic,t.chatIsOpen]),(0,i.useEffect)(()=>{let e=async()=>{let e=window.location.hash,t=window.location.pathname,s=window.location.hash?`${t}${e}`:t,r=s.slice(1).split("/");if(r.length<2)return;let a=r[0],i=r[1];a&&i&&await f.fetchImplicitContext(s,a,i)},s=(0,a.s)(()=>{e()},500);o.W.implicitContext&&t.chatIsOpen&&(s(),function(){let{replaceState:e}=window.history;window.history.replaceState=function(...t){e.apply(window.history,t),window.dispatchEvent(new Event("replaceState"))},window.addEventListener("popstate",s),window.addEventListener("replaceState",s),()=>{window.removeEventListener("popstate",s),window.removeEventListener("replaceState",s)}}())},[f,t.chatIsOpen]),(0,r.jsx)(u.Provider,{value:f,children:h})}function h(){let e=(0,i.useContext)(u);if(!e)throw Error("useChatManager must be used within a CopilotChatManagerProvider");return e}try{u.displayName||(u.displayName="CopilotChatManagerContext")}catch{}try{d.displayName||(d.displayName="CopilotChatManagerProvider")}catch{}},64003:(e,t,s)=>{s.d(t,{rE:()=>o,sw:()=>i,tD:()=>n});var r=s(96540);let a=(0,r.createContext)(null),i=a.Provider;function n(){let e=(0,r.useContext)(a);if(!e)throw Error("useGetChatState can only be used inside a CopilotChatProvider");return(0,r.useCallback)(()=>e.value,[e])}function o(){return(0,r.useContext)(a)}try{a.displayName||(a.displayName="ObservableChatStateContext")}catch{}},31142:(e,t,s)=>{s.d(t,{e8:()=>CopilotChatManager,SL:()=>E,AG:()=>_});var r,a=s(74848),i=s(51315),n=s(98063),o=s(46335);let InteractDomSkill=class InteractDomSkill{requiresConfirmation(){return"click"===JSON.parse(this.rawArguments).action}confirmationMessage(){let e=JSON.parse(this.rawArguments),t="";switch(e.action){case"click":t=`Click on ${e.element}`;break;case"type":t=`Type "${e.value}" into ${e.element}`}return t}static schema(){return{type:"function",function:{name:"interact-dom",description:"Perform an action like clicking on an element, typing into an input, or filling out a form on the current html page. Call this skill to fulfill the user request after receiving the current url and tag map of accessible element names to their tags from invoking the read-dom skill. For the type action, if there is existing text in the elemt (passed in the tag map), you should modify that text how the user requests and return the new text contents. Do no just return the new text the user asked you to type unless they are explicitly trying to overwrite the current value. Afterwards, you should send a message letting the user know the actions you performed.",parameters:{type:"object",required:["action, element"],properties:{action:{type:"string",description:'The DOM action to take on an element on the current page. The action property can either be "click" or "type". If it is "type" then the value property should be the string to type into the input element.'},element:{type:"string",description:"The accessible name of the element to perform the DOM action on."},value:{type:"string",description:"If the action is 'type', then value is the string to type into the text input element. The text input's value will be set to this, so if the element has an existing value from the tag map passed in, make sure to include that in this paramter."}}}}}}execute(){let e=JSON.parse(this.rawArguments),t=this.chatState?.elementMap?.get(e.element),s="";if(t instanceof HTMLElement)switch(e.action){case"click":t.click(),s=`${e.element} was clicked.`;break;case"type":"value"in t?(t.value=e.value||"",s=`${e.value} was typed into ${e.element}.`):s=`${e.element} could not be typed into because it was not an element thay accepts a value like textarea or input.`}else s=`${e.element} could not be located.`;return{name:this.name,arguments:this.rawArguments,result:s}}constructor(e,t,s,r){this.id=e,this.name=t,this.rawArguments=s,this.chatState=r}};var l=s(6786);let ReadDomSkill=class ReadDomSkill{requiresConfirmation(){return!1}confirmationMessage(){return"Read the DOM for the current page"}static schema(){return{type:"function",function:{name:"read-dom",description:"Allows you to interact with the DOM to perform actions like filling out forms, submitting forms, clicking on buttons, and typing into inputs on the current web page. This function requests a list of all interactable elements on the current html page, keyed by their accessible name. If the user makes a request to interact with elements on the current web page, but has not provided any DOM elements in clientToolResults, call this function. After the results are returned, call interact-dom to actually perform the desired interactions. If the user asks a question about the DOM, you can call this to read its state, but do not follow up with an interact-dom call in that case. Finally, let the user know what actions you performed",parameters:{type:"object",properties:{}}}}}execute(){let e={},t=new Map;for(let s of document.querySelectorAll('input, select, textarea, button, [role="button"], a, [tabindex]')){let r=(0,l.G3)(s);t.set(r,s);let a=s.tagName,i=s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement?s.value:null;e[r]={tag:a,value:i}}this.dispatch?.({type:"READ_DOM_SKILL_INVOKED",elementMap:t});let s=JSON.stringify({tagMap:e,url:window.location.href});return{name:this.name,arguments:this.rawArguments,result:s}}constructor(e,t,s,r,a){this.id=e,this.name=t,this.rawArguments=s,this.dispatch=a}};let c={"read-local-workspace-file":s(91441).K,"read-dom":ReadDomSkill,"interact-dom":InteractDomSkill};var u=s(38253),d=s(64575),h=s(96335),p=s(84569),m=s(10411),g=s(3004),f=s(24538);let UnknownClientSkill=class UnknownClientSkill{requiresConfirmation(){return!1}confirmationMessage(){return"Unknown function"}execute(){return{name:this.name,arguments:this.rawArguments,result:`Unknown function: ${this.name} called with args: ${this.rawArguments}`}}schema(){return{type:"function",function:{name:"unknown-client-skill",description:"This is a fallback skill if the skill is not found"}}}constructor(e,t,s,r,a){this.id=e,this.name=t,this.rawArguments=s,this.chatState=r,this.dispatch=a}};let E="copilot_delete_all_conversations",_="copilot_staff_prompt_dialog",S=null;let CopilotChatManager=class CopilotChatManager{async openChat(e,t,s,r,a){if(this.dispatch({type:"OPEN_COPILOT_CHAT",source:s}),"thread"===t&&await this.findOrStartNewThread(e,a),g.J.setCollapsedState(!1),I(!0),r){let e=new FormData;e.set("copilot_chat_visible","true"),(0,o.DI)(r,{method:"PUT",body:e})}}closeChat(){this.dispatch({type:"CLOSE_COPILOT_CHAT"}),g.J.setCollapsedState(!0),I(!1)}hideChat(e){if(this.dispatch({type:"HIDE_COPILOT_CHAT"}),this.closeChat(),e){let t=new FormData;t.set("copilot_chat_visible","false"),(0,o.DI)(e,{method:"PUT",body:t})}}toggleRepoCustomInstructions(e){this.dispatch({type:"TOGGLE_REPO_CUSTOM_INSTRUCTIONS",value:e}),g.J.setRepoCustomInstructionsState(e)}viewAllThreads(){this.dispatch({type:"VIEW_ALL_THREADS"})}viewCurrentThread(){this.dispatch({type:"VIEW_CURRENT_THREAD"})}async sendChatMessage({thread:e,content:t,references:s,topic:r,context:a,confirmations:i,customInstructions:n,model:o,customCopilotId:l,intent:c=p.wh.conversation,tools:d,clientToolResults:h}){let m=(0,u.P)(r),g=m?void 0:r;return m&&!s.some(e=>"docset"===e.type&&e.name===r.name)&&s.push({type:"docset",name:r.name,id:r.id,avatarUrl:r.avatarUrl,repos:r.repos,description:r.description}),this.sendNewMessage(e,t,c,s,g,a,i,n,o,l,"",d,h)}async retryLastChatMessage(e){let{currentTopic:t,context:s,customInstructions:r,model:a}=this.getChatState(),i=(0,u.P)(t)?void 0:t;return this.resendLastMessage(e,s,i,r,a)}async stopStreaming(){this.streamer?(await this.streamer.stop(),this.streamer=void 0):this.messageAbortController?.abort(),this.dispatch({type:"MESSAGE_STREAMING_STOPPED",timings:this.completeTiming()})}async getSystemPrompt(){let{mode:e}=this.getChatState();return await this.systemPrompt(e)}async sendNewMessage(e,t,s,r,a,i,n,o,l,c,d,h,p){let m=(0,u.Y6)({role:"user",content:t,references:r,thread:e,confirmationResponses:n?[n]:[],parentMessageID:d});if(this.dispatch({type:"MESSAGE_ADDED",message:m,repoHasCustomInstructions:!!a?.customInstructions,usedRepoCustomInstructions:!!(a?.customInstructions&&this.repoInstructionsEnabled())}),!e){let s=await this.service.createThread();if(s.ok)e=s.payload,g.J.migrateNullThreadToNewThread(e.id),this.dispatch({type:"THREAD_CREATED",thread:e});else{this.handleSendMessageError(e,w(s.error),t);return}}return this.dispatch({type:"THREAD_UPDATED",thread:{...e,updatedAt:new Date().toISOString()}}),this.unstickyReferencesFeatureEnabled&&this.dispatch({type:"CLEAR_REFERENCES",threadID:e.id}),l&&g.J.setModel(e.id,l),this.sendMessage(e,t,r,s,i,a,o,l,n,c,d,h,p)}async resendLastMessage(e,t,s,r,a){let i=this.getChatState().messages.findLast(e=>"user"===e.role);if(!i?.content)return;let n=e.currentReferences||[];return this.dispatch({type:"MESSAGES_CLEAR_LAST_ERROR"}),this.sendMessage(e,i.content,n,p.wh.conversation,t,s,r,a)}async sendMessage(e,t,s,r,a,i,o,l,c,h,p,g,f){let E=(0,u.Y6)({role:"assistant",content:"",thread:e,active:!0}),_=g?[...g]:[];this.dispatch({type:"WAITING_ON_COPILOT",loading:!0});let S=s.length&&(1!==s.length||s[0]?.type!=="repository")?void 0:a;(0,n.BI)("copilot.implicit_context",{usedImplicitContext:!!S,type:S?.[0]?.type,count:S?.length}),!s.length&&i&&(s=[(0,u.qS)(i)]);let y=[];i?.customInstructions&&this.repoInstructionsEnabled()&&y.push(i.customInstructions),o&&y.push(o);let{mode:T}=this.getChatState();this.timings={startTime:Date.now()},this.streamer=void 0,this.messageAbortController=new AbortController,m.W.clientDOMSkills&&-1===window.location.href.indexOf("/settings/")&&_.push(ReadDomSkill.schema(),InteractDomSkill.schema());try{let a=await this.service.createMessageStreaming(e.id,t,r,T,s,S??[],c?[c]:[],y,l?.id,h,p,_,f,this.messageAbortController.signal);if(a.ok){let s=a.response.body?.getReader();if(!s){this.handleSendMessageError(e,w(u.DW),t);return}let r=new d.X(s);this.streamer=r,this.dispatch({type:"MESSAGE_STREAMING_STARTED",message:E}),await this.handleStreamingMessage(e,r)}else{if(this.messageAbortController.signal.aborted)return;this.handleSendMessageError(e,w(a.error),t)}}finally{this.streamer=void 0,this.messageAbortController=void 0}}repoInstructionsEnabled(){return(m.W.repoCustomInstructions||m.W.repoCustomInstructionsPreview)&&g.J.getRepoCustomInstructionsState()}addReference(e,t){this.dispatch({type:"ADD_REFERENCE",reference:e,source:t})}removeReference(e){this.dispatch({type:"REMOVE_REFERENCES",referenceIndexes:[e]})}removeReferences(e){this.dispatch({type:"REMOVE_REFERENCES",referenceIndexes:e})}selectModel(e){this.dispatch({type:"SELECT_MODEL",model:e}),g.J.setModel(this.getChatState().selectedThreadID,e)}setCopilotSettings(e){g.J.settings=e}async dismissAttachKnowledgeBaseHerePopover(){this.dispatch({type:"DISMISS_ATTACH_KNOWLEDGE_BASE_HERE_POPOVER"}),await (0,o.DI)("/settings/dismiss-notice/copilot_for_docs_attach_knowledge_base_here",{method:"POST"})}async dismissKnowledgeBaseAttachedToChatPopover(){this.dispatch({type:"DISMISS_KNOWLEDGE_BASE_ATTACHED_TO_CHAT_POPOVER"}),await (0,o.DI)("/settings/dismiss-notice/copilot_for_docs_knowledge_base_attached_to_chat",{method:"POST"})}async selectThread(e,t){let{clearTopic:s,includeThreads:r=!0}=t??{};await this.fetchModels(),await this.stopStreaming(),this.dispatch({type:"SELECT_THREAD",thread:e,clearTopic:s});let a=[];a.push(this.fetchMessages(e?.id||null)),r&&a.push(this.fetchThreads()),await Promise.all(a)}addMessage(e,t,s,r,a,i){let n=(0,u.Y6)({role:e,content:s,references:r,thread:t,confirmationResponses:a,clientSkillConfirmations:i});this.dispatch({type:"MESSAGE_ADDED",message:n})}async renameThread(e,t){(await this.service.renameThread(e.id,t)).ok&&this.dispatch({type:"THREAD_UPDATED",thread:{...e,name:t}})}async clearThread(e){(await this.service.clearThread(e.id)).ok&&this.dispatch({type:"CLEAR_THREAD",threadID:e.id})}async deleteThreadKeepSelection(e){this.dispatch({type:"DELETE_THREAD_KEEP_SELECTION",thread:e});let t=await this.service.deleteThread(e.id);t.ok||this.dispatch({type:"DELETE_THREAD_ERROR",thread:e,error:t.error})}async deleteAllThreadKeepSelection(e){this.dispatch({type:"DELETE_ALL_THREADS_KEEP_SELECTION",threads:e});let t=e.map(e=>e.id);for(let s=0;s<t.length;s+=100){let r=t.slice(s,s+100),a=await this.service.deleteAllThreads({threadIDs:r});a.ok||this.dispatch({type:"DELETE_ALL_THREADS_ERROR",threads:e,error:a.error})}}async deleteThread(e){this.dispatch({type:"DELETE_THREAD",thread:e});let t=await this.service.deleteThread(e.id);t.ok||this.dispatch({type:"DELETE_THREAD_ERROR",thread:e,error:t.error})}generateSuggestions(e){let t="type"in e&&"string"==typeof e.type?e.type:"repository",s=(0,u.mx)(t);this.dispatch({type:"SUGGESTIONS_GENERATED",suggestions:s})}clearSuggestions(){this.dispatch({type:"CLEAR_SUGGESTIONS"})}async handleOpenPanelEvent(e,t,s){let r=t.payload;if(y(r)||T(r,[p.wh.conversation])&&"newThread"in r&&r.newThread?(await this.selectThread(null),e=null):T(r,[p.wh.reviewPr])?(this.addMessage("user",r.thread,i.Bc,r.references),this.addMessage("assistant",r.thread,r.completion,r.references),this.selectThread(r.thread,{includeThreads:!1})):e=await this.findOrStartNewThread(e),this.dispatch({type:"HANDLE_EVENT_START",references:r.references,id:r.id}),T(r,[p.wh.conversation,p.wh.discussFileDiff,p.wh.reviewPr])&&!y(r))return;let a=`blob ${r.intent}`;r.id&&(a=`element ${t.payload.id}`),(0,n.BI)("copilot.open_copilot_chat",{source:a}),await this.sendNewMessage(e,r.content,r.intent,r.references??[],(0,u.Z6)(s)?s:void 0)}async handleSearchCopilotEvent(e){let t=await this.fetchCurrentRepo(e.repoNwo),s=t?[{type:"repository",...t}]:[];this.openChat(null,"thread","search-bar"),await this.sendNewMessage(null,e.content,p.wh.conversation,s),(0,n.BI)("copilot.open_copilot_chat",{source:"search-bar"})}async handleAddReferenceEvent(e){await this.findOrStartNewThread(),this.addReference(e.reference,"event"),e.openPanel&&this.dispatch({type:"OPEN_COPILOT_CHAT",source:"event",id:e.id})}handleSymbolChangedEvent(e){let t=e.context;this.dispatch({type:"IMPLICIT_CONTEXT_UPDATED",context:[t]})}getSelectedThread(e){return e.selectedThreadID&&e.threads.get(e.selectedThreadID)||null}sortThreads(e){return Array.from(e.values()).sort((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime())}async sendMessageToNewThread(e,t,s,r){""!==t.trim()&&(e&&(g.J.setSavedMessageFast(e,null),g.J.clearCurrentReferences(e)),await this.sendNewMessage(null,t,p.wh.conversation,s,void 0,r))}async fetchMessages(e){let t=g.J.getCurrentReferences(e);if(!e){this.threadDataLoaded([],t||[]);return}this.dispatch({type:"MESSAGES_UPDATED",state:"loading"});let s=await this.service.listMessages(e);if(s.ok){let e=s.payload.thread;this.threadDataLoaded(s.payload.messages,t||e.currentReferences||[])}else this.dispatch({type:"MESSAGES_UPDATED",state:"error"})}async fetchSharedThreadMessages(e){if(!e)return;this.dispatch({type:"MESSAGES_UPDATED",state:"loading"});let t=await this.service.listSharedThreadMessages(e);t.ok?this.threadDataLoaded(t.payload.messages,[]):this.dispatch({type:"MESSAGES_UPDATED",state:"error"})}selectReference(e){this.dispatch({type:"SELECT_REFERENCE",reference:e})}setTopRepositoryTopics(e){this.dispatch({type:"SET_TOP_REPOSITORIES",topics:e})}async handleStreamingMessage(e,t){try{for await(let s of t.stream())await this.processStreamingMessage(e,s)}catch(s){let t=this.isWrappedStreamingResponseError(s)?this.getStreamingErrorMessage(s.error):w(u.DW);this.handleSendMessageError(e,t);return}}async executeClientSkills(e){let t=await Promise.all(e.map(async e=>{let t=await e.execute();return{id:e.id,type:"function",functionCallResult:t}}));await this.sendChatMessage({thread:this.getSelectedThread(this.getChatState()),content:"",references:[],clientToolResults:t})}isWrappedStreamingResponseError(e){return!!e&&"object"==typeof e&&"error"in e&&!!e.error&&"object"==typeof e.error&&"errorType"in e.error&&"string"==typeof e.error.errorType&&p.C6.includes(e.error.errorType)}generateConfirmationMessage(e){let t="";for(let s of e)t+=`${s.confirmationMessage()}
`;return t}async processStreamingMessage(e,t){var s,r,a;switch((s=this.timings).firstByte??(s.firstByte=Date.now()),t.type){case"content":(r=this.timings).firstToken??(r.firstToken=Date.now()),this.dispatch({type:"MESSAGE_STREAMING_TOKEN_ADDED",token:t.body});break;case"functionCall":a=t.name,p.xP.includes(a)&&this.dispatch({type:"MESSAGE_STREAMING_FUNCTION_CALLED",name:t.name,status:t.status,arguments:t.arguments,errorMessage:t.errorMessage,references:t.references});break;case"clientSkillsRequest":if(m.W.dotcomChatClientSideSkills){let e=this.getChatState(),s=t.toolCalls.map(t=>{let s=c[t.function.name];return s?new s(t.id,t.function.name,t.function.arguments,e,this.dispatch):new UnknownClientSkill(t.id,t.function.name,t.function.arguments,e,this.dispatch)});if(s.some(e=>e.requiresConfirmation())){let r=[{title:"Confirm actions",message:this.generateConfirmationMessage(s),onSubmit:e=>{if(e)this.executeClientSkills(s);else{let e=s.map(e=>{let t={name:e.name,arguments:e.rawArguments,result:"skill could not be executed due to user confirmation rejection"};return{id:e.id,type:"function",functionCallResult:t}});this.sendChatMessage({thread:this.getSelectedThread(this.getChatState()),content:"",references:[],clientToolResults:e})}},confirmation:{toolCalls:t.toolCalls}}];this.addMessage("assistant",this.getSelectedThread(e),"I need your permission to perform the following actions",[],[],r)}else await this.executeClientSkills(s)}break;case"confirmation":this.dispatch({type:"MESSAGE_STREAMING_CONFIRMATION",title:t.title,message:t.message,confirmation:t.confirmation});break;case"complete":this.dispatch({type:"MESSAGE_STREAMING_COMPLETED",messageResponse:t,timings:this.completeTiming()}),await this.handleSendMessageSuccess(e);break;case"error":{let s=this.getStreamingErrorMessage(t);this.handleSendMessageError(e,s);break}case"debug":console.log("Prompt Body:",t.body);break;case"agentError":this.dispatch({type:"AGENT_ERROR",error:{type:t.agentErrorType,code:t.code,message:t.message,identifier:t.identifier}})}}getStreamingErrorMessage(e){switch(e.errorType){case"publicCode":{let e="https://docs.github.com/en/copilot/managing-copilot/managing-copilot-as-an-individual-subscriber/managing-copilot-policies-as-an-individual-subscriber",t=(0,a.jsxs)(a.Fragment,{children:["This response cannot be shown because it references public code, which is restricted by"," ",(0,a.jsx)("a",{href:e,children:"your Copilot settings"}),"."]});return this.hasCEorCBAccess&&(e="https://docs.github.com/en/enterprise-cloud@latest/copilot/managing-copilot/managing-github-copilot-in-your-organization/managing-policies-for-copilot-in-your-organization",t=(0,a.jsxs)(a.Fragment,{children:["This response cannot be shown because it references public code, which is restricted by"," ",(0,a.jsx)("a",{href:e,children:"your organization's Copilot settings"}),"."]})),{type:"basic",isError:!0,message:t,retryable:!1}}case"filtered":return C(u.Sr[403]||u.DW);case"contentTooLarge":return C(u.Sr[413]||u.DW);case"rateLimit":return w(u.Sr[429]||u.DW);case"agentUnauthorized":{let t=JSON.parse(e.description);return{type:"agentUnauthorized",isError:!0,message:`You haven't authorized ${t.name} to access your account. You can do that by going here: ${window.location.origin}/login/oauth/authorize?client_id=${t.client_id}`,details:t}}case"agentRequest":{let t=JSON.parse(e.description);return{type:"agentRequest",isError:!0,message:t.message,details:t}}case"multipleAgentsAttempt":return w("Only one agent is allowed per thread, and their context can't be shared. If you want to interact with another agent, please start a new thread and @ mention the new agent.");case"networkError":return w(u.Sr[408]||u.DW);default:return w(u.DW)}}async handleSendMessageSuccess(e){g.J.setSavedMessageFast(e.id,null),g.J.clearCurrentReferences(e.id),this.dispatch({type:"WAITING_ON_COPILOT",loading:!1}),e=await this.generateThreadName(e),this.dispatch({type:"THREAD_UPDATED",thread:{...e,updatedAt:new Date().toISOString()}})}handleSendMessageError(e,t,s){e&&s&&m.W.copilotChatPersistSubmittedInput&&g.J.setSavedUserMessageOnError(e.id,s);let r=(0,u.Y6)({role:"assistant",content:"",error:t,thread:e});this.dispatch({type:"MESSAGE_ADDED",message:r}),this.dispatch({type:"WAITING_ON_COPILOT",loading:!1}),this.dispatch({type:"MESSAGE_STREAMING_FAILED",timings:this.completeTiming()})}async fetchModels(){if(S){let{availableModels:e}=this.getChatState();(!e||S.length>e.length)&&this.dispatch({type:"MODELS_LOADED",models:S});return}this.dispatch({type:"MODELS_LOADING"});let e=await this.service.listModels();if(e.ok){let t=(0,f.e)(e.payload);S=t,this.dispatch({type:"MODELS_LOADED",models:t});let s=g.J.getModel(this.getChatState().selectedThreadID)?.id,r=t.find(e=>e.id===s);r&&this.dispatch({type:"SELECT_MODEL",model:r})}else this.dispatch({type:"MODELS_LOADING_ERROR",error:e.error})}async acceptModelPolicy(e){e.policy&&"enabled"!==e.policy.state&&(await this.service.setModelPolicyState(e.id,"enabled"),S=null,this.fetchModels())}async fetchThreads(){this.dispatch({type:"THREADS_LOADING"});let e=await this.service.fetchThreads();return e.ok?(setTimeout(()=>this.dispatch({type:"THREADS_LOADED",threads:e.payload}),100),e.payload):(setTimeout(()=>this.dispatch({type:"THREADS_LOADING_ERROR",message:e.error}),100),null)}async fetchLatestThread(e){let t=await this.service.fetchLatestThread(e);return t.ok?(t.payload&&this.dispatch({type:"LATEST_THREAD_LOADED",latestThread:t.payload}),t.payload):null}async findOrStartNewThread(e,t){let s=null;if(e)s=e;else{let e=g.J.selectedThreadID||void 0;s=await this.fetchLatestThread(e)}if(s&&(0,u.F2)(s)&&(s=null),s&&t){let e=await this.service.listMessages(s.id);if(e.ok){let r=e.payload.messages,a=r?.length;a>=2&&!r[a-2]?.references?.find(e=>u.x_(e,t))&&(s=null)}}return await this.selectThread(s,{includeThreads:!1}),s}async generateThreadName(e){if(e.name)return e;let t=await this.service.generateThreadName(e.id);return t.ok&&(e={...e,name:t.payload}),e}async systemPrompt(e){let t=await this.service.getSystemPrompt(e);return t.ok?t.payload.prompt:""}async fetchAgents(e){let t=await this.service.listAgents(e),s=[];return t.ok&&(s=t.payload,this.dispatch({type:"SET_AGENTS",agents:s})),s}async fetchCustomCopilots(){let e=await this.service.listCustomCopilots(),t=[];return e.ok&&(t=e.payload,this.dispatch({type:"SET_CUSTOM_COPILOTS",customCopilots:t})),t}async fetchCurrentRepo(e){this.dispatch({type:"CURRENT_TOPIC_UPDATED",topic:void 0,state:"loading"});let t=await this.service.fetchRepo(e);if(t.ok)return this.dispatch({type:"CURRENT_TOPIC_UPDATED",topic:t.payload,state:"loaded"}),t.payload;this.dispatch({type:"CURRENT_TOPIC_UPDATED",topic:void 0,state:"error"})}async fetchKnowledgeBases(){this.dispatch({type:"KNOWLEDGE_BASES_LOADING"});let e=await this.service.listDocsets();return e.ok?this.dispatch({type:"KNOWLEDGE_BASES_LOADED",knowledgeBases:e.payload}):this.dispatch({type:"KNOWLEDGE_BASES_LOADING_ERROR",message:e.error}),e}async fetchImplicitContext(e,t,s){let r=await this.service.fetchImplicitContext(e,t,s);if(r.ok){let e=r.payload?Array.isArray(r.payload)?r.payload:[r.payload]:void 0;this.dispatch({type:"IMPLICIT_CONTEXT_UPDATED",context:e})}}async deleteDocset(e){return(await this.service.deleteDocset(e)).ok}threadDataLoaded(e,t){this.dispatch({type:"MESSAGES_UPDATED",messages:e,state:"loaded"}),this.dispatch({type:"REFERENCES_LOADED",references:t})}dismissEditorUpsellBanner(){let e=new FormData;e.set("copilot_editor_upsell_banner_dismissed","true"),(0,o.DI)("/github-copilot/preferences",{method:"PUT",body:e}),this.dispatch({type:"DISMISS_EDITOR_UPSELL_BANNER"})}completeTiming(){return{...this.timings,endTime:Date.now()}}constructor(e,t,s,r,a,i,n){this.unstickyReferencesFeatureEnabled=m.W.unstickyReferences,this.timings={startTime:0},this.clearCurrentReferences=()=>{this.dispatch({type:"CLEAR_CURRENT_REFERENCES"})},this.clearCurrentTopic=()=>{this.dispatch({type:"CURRENT_TOPIC_UPDATED",topic:void 0,state:"loaded"})},this.showTopicPicker=(e=!0)=>{this.dispatch({type:"SHOW_TOPIC_PICKER",show:e})},this.dispatch=e,this.service=i??new h.k(t,s,a),this.getChatState=r,this.hasCEorCBAccess=!!n}};function y(e){var t;return T(e,[p.wh.explain,p.wh.suggest])||T(e,[p.wh.conversation])&&"content"in(t=e)&&"string"==typeof t.content}function T(e,t){return new Set(t).has(e.intent)}function w(e){return{isError:!0,message:e,type:"basic",retryable:!0}}function C(e){return{isError:!0,message:e,type:"basic",retryable:!1}}function I(e){let t=document.getElementById(i.fv);t?.setAttribute("aria-expanded",e?"true":"false")}try{(r=Intent).displayName||(r.displayName="Intent")}catch{}},16142:(e,t,s)=>{s.d(t,{T:()=>BlobService});var r=s(85749),a=s(38253),i=s(46335),n=s(51793);let BlobService=class BlobService{async fetchBlob(e,t,s,r,o){try{let l=(0,n.WN)({commitOid:o,owner:t,path:e,pullNumber:s,repo:r}),c=await (0,i.Sr)(l,{method:"GET"});if(c.ok){let e=await c.json();return{status:c.status,ok:!0,payload:e}}return{status:c.status,ok:!1,error:a.DW}}catch{return{status:500,ok:!1,error:a.DW}}}async getBlob(e,t,s,r,a){return this.blobCache.get(e,t,s,r,a)}constructor(){this.blobCache=new r.d(this.fetchBlob)}}},91646:(e,t,s)=>{s.d(t,{kk:()=>a,mL:()=>o,qm:()=>n,sT:()=>r,t:()=>i});let r="open_panel",a="pull_request_review_comment_id",i="initial_path";function n(e){let t=new URL(window.location.href,window.location.origin);t.searchParams.delete(e),window.history.pushState(null,"",t.toString())}function o(e,t,s){let r=new URL(window.location.href,window.location.origin);r.searchParams.set(e,t),s?s(r.searchParams):window.history.pushState(null,"",r.toString())}},51793:(e,t,s)=>{s.d(t,{KD:()=>d,PW:()=>u,WN:()=>h,Wd:()=>i,ic:()=>g,iw:()=>c,sy:()=>m,tH:()=>l,uY:()=>p});var r=s(4227),a=s(91646);let i="edit";function n({owner:e,repo:t,pullNumber:s}){return`/${encodeURIComponent(e)}/${encodeURIComponent(t)}/pull/${s}`}function o({owner:e,repo:t,pullNumber:s}){return`${n({owner:e,repo:t,pullNumber:s})}/${i}`}function l({owner:e,repo:t,pullNumber:s,location:r}){return o({owner:e,repo:t,pullNumber:s})+(r?.search||"")}function c({owner:e,repo:t,pullNumber:s,path:a,location:i}){return`${o({owner:e,repo:t,pullNumber:s})}/file/${(0,r.QU3)(a)}`+(i?.search||"")}function u({owner:e,repo:t,pullNumber:s}){return`${n({owner:e,repo:t,pullNumber:s})}/workspace_editor/suggestions`}function d({owner:e,repo:t,pullNumber:s,pullRequestReviewCommentId:r}){return`${n({owner:e,repo:t,pullNumber:s})}/workspace_editor/suggestions/${r}`}function h({commitOid:e,owner:t,repo:s,pullNumber:r,path:a,location:i}){return`${n({owner:t,repo:s,pullNumber:r})}/workspace_editor/files/${encodeURIComponent(e)}/${encodeURIComponent(a)}`+(i?.search||"")}function p({owner:e,repo:t,pullNumber:s,location:r,path:i}){let n=`${o({owner:e,repo:t,pullNumber:s})}/new`,l=new URLSearchParams(r?.search||"");if(i&&i.includes("/")){let e=i.substring(0,i.lastIndexOf("/")+1);l.set(a.t,e)}return n+(l.toString()?`?${l.toString()}`:"")}function m({owner:e,repo:t,pullNumber:s}){return`${o({owner:e,repo:t,pullNumber:s})}/commit_changes`}function g({owner:e,repo:t,pullNumber:s,analyzeDiffs:r=!1,detectRisk:a=!1}){let i=`${n({owner:e,repo:t,pullNumber:s})}/diff`,o=new URLSearchParams({analyze_diffs:r.toString(),detect_risk:a.toString()});return`${i}?${o.toString()}`}}}]);
//# sourceMappingURL=ui_packages_copilot-chat_utils_copilot-chat-hooks_ts-ui_packages_issue-viewer_utils_queries_ts-bc8caf1fd7a2.js.map